# VEO AI å¹³å° - è¿è¥æ‰‹å†Œ

> **æ—¥å¸¸è¿è¥æŒ‡å— | Operation Manual**

---

## ğŸ“‹ ç›®å½•

1. [ç®¡ç†åå°ä½¿ç”¨](#ç®¡ç†åå°ä½¿ç”¨)
2. [ç§¯åˆ†å…‘æ¢ç ç®¡ç†](#ç§¯åˆ†å…‘æ¢ç ç®¡ç†)
3. [è®¢å•ç®¡ç†](#è®¢å•ç®¡ç†)
4. [ç”¨æˆ·ç®¡ç†](#ç”¨æˆ·ç®¡ç†)
5. [å†…å®¹å®¡æ ¸](#å†…å®¹å®¡æ ¸)
6. [æ•°æ®ç»Ÿè®¡](#æ•°æ®ç»Ÿè®¡)
7. [å®¢æˆ·æœåŠ¡](#å®¢æˆ·æœåŠ¡)
8. [å¸¸è§é—®é¢˜å¤„ç†](#å¸¸è§é—®é¢˜å¤„ç†)

---

## ç®¡ç†åå°ä½¿ç”¨

### è®¿é—®ç®¡ç†åå°

**åœ°å€**: `https://yourdomain.com/admin/redemption-codes`

**æƒé™**: éœ€è¦ç®¡ç†å‘˜è´¦å·ç™»å½•

### ä¸»è¦åŠŸèƒ½æ¨¡å—

1. **ç§¯åˆ†å…‘æ¢ç ç®¡ç†** - `/admin/redemption-codes`
2. **è®¢å•ç®¡ç†** - æ•°æ®åº“ç›´æ¥æŸ¥è¯¢
3. **ç”¨æˆ·ç®¡ç†** - æ•°æ®åº“ç›´æ¥æŸ¥è¯¢
4. **æ•°æ®ç»Ÿè®¡** - å¾…å¼€å‘

---

## ç§¯åˆ†å…‘æ¢ç ç®¡ç†

### ç”Ÿæˆå…‘æ¢ç 

**é€‚ç”¨åœºæ™¯**ï¼šå¤‡æ¡ˆå‰æ‰‹åŠ¨é”€å”®ç§¯åˆ†

#### æ“ä½œæ­¥éª¤

1. è®¿é—® `/admin/redemption-codes`
2. ç‚¹å‡»"ç”Ÿæˆå…‘æ¢ç "æŒ‰é’®
3. å¡«å†™è¡¨å•ï¼š
   - **ç”Ÿæˆæ•°é‡**: 1-1000ä¸ª
   - **ç§¯åˆ†æ•°é‡**: ä»»æ„æ­£æ•´æ•°
   - **å¥—é¤ç±»å‹**: é€‰æ‹©å¯¹åº”å¥—é¤
   - **æœ‰æ•ˆæœŸ**: å»ºè®®30å¤©
   - **å¤‡æ³¨**: è®°å½•ç”¨é€”ï¼ˆå¦‚ï¼šæ¨å¹¿æ´»åŠ¨ã€èµ é€ç­‰ï¼‰
4. ç‚¹å‡»"ç”Ÿæˆ"
5. ç³»ç»Ÿè‡ªåŠ¨ä¸‹è½½å…‘æ¢ç æ–‡ä»¶

#### å…‘æ¢ç æ ¼å¼

```
VEO-ABCD-1234
```

- å‰ç¼€ï¼š`VEO-`
- ä¸¤æ®µ4ä½å­—ç¬¦ï¼ˆå¤§å†™å­—æ¯+æ•°å­—ï¼‰
- å»é™¤æ˜“æ··æ·†å­—ç¬¦ï¼ˆ0,O,1,Iï¼‰

#### å‘é€ç»™ç”¨æˆ·

**æ–¹å¼1ï¼šç›´æ¥å¤åˆ¶å…‘æ¢ç **
```
æ‚¨çš„å…‘æ¢ç ï¼šVEO-ABCD-1234
æœ‰æ•ˆæœŸï¼š30å¤©
è¯·è®¿é—® https://yourdomain.com/redeem å…‘æ¢
```

**æ–¹å¼2ï¼šæ‰¹é‡å¯¼å‡º**
- ä¸‹è½½ç”Ÿæˆçš„txtæ–‡ä»¶
- é€šè¿‡é‚®ä»¶/å¾®ä¿¡å‘é€

### æŸ¥çœ‹å…‘æ¢ç çŠ¶æ€

#### çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ | é¢œè‰² |
|------|------|------|
| ACTIVE | å¯ç”¨ | ç»¿è‰² |
| REDEEMED | å·²å…‘æ¢ | ç°è‰² |
| EXPIRED | å·²è¿‡æœŸ | æ©™è‰² |
| VOIDED | å·²ä½œåºŸ | çº¢è‰² |

#### ç­›é€‰åŠŸèƒ½

- **å…¨éƒ¨**: æŸ¥çœ‹æ‰€æœ‰å…‘æ¢ç 
- **å¯ç”¨**: æœªä½¿ç”¨çš„å…‘æ¢ç 
- **å·²å…‘æ¢**: æŸ¥çœ‹è°ä½¿ç”¨äº†
- **å·²è¿‡æœŸ**: å¯ä»¥åˆ é™¤
- **å·²ä½œåºŸ**: æ‰‹åŠ¨ä½œåºŸçš„

### ä½œåºŸå…‘æ¢ç 

**åœºæ™¯**: å‘é”™å…‘æ¢ç ã€ç”¨æˆ·é€€æ¬¾ç­‰

**æ“ä½œ**: 
1. æ‰¾åˆ°å¯¹åº”å…‘æ¢ç 
2. ç‚¹å‡»å³ä¾§"ä½œåºŸ"å›¾æ ‡
3. ç¡®è®¤ä½œåºŸ
4. âš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€

---

## è®¢å•ç®¡ç†

### æŸ¥è¯¢è®¢å•

#### ä½¿ç”¨SQLæŸ¥è¯¢ï¼ˆæ•°æ®åº“ç®¡ç†å·¥å…·ï¼‰

```sql
-- æŸ¥çœ‹æœ€è¿‘è®¢å•
SELECT 
  order_number, 
  package_name, 
  amount, 
  status,
  created_at,
  paid_at
FROM credit_orders
ORDER BY created_at DESC
LIMIT 50;

-- æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„è®¢å•
SELECT * FROM credit_orders
WHERE user_id = 'user_id_here'
ORDER BY created_at DESC;

-- ç»Ÿè®¡ä»Šæ—¥è®¢å•
SELECT 
  COUNT(*) as total_orders,
  SUM(amount) as total_amount,
  SUM(CASE WHEN status = 'PAID' THEN amount ELSE 0 END) as paid_amount
FROM credit_orders
WHERE DATE(created_at) = CURRENT_DATE;
```

### è®¢å•çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ | æ“ä½œ |
|------|------|------|
| PENDING | å¾…æ”¯ä»˜ | ç­‰å¾…ç”¨æˆ·æ”¯ä»˜ |
| PAID | å·²æ”¯ä»˜ | å·²å®Œæˆç§¯åˆ†å……å€¼ |
| CANCELLED | å·²å–æ¶ˆ | è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ |
| REFUNDED | å·²é€€æ¬¾ | éœ€è¦æ‰£é™¤ç§¯åˆ† |

### æ‰‹åŠ¨å¤„ç†è®¢å•

#### åœºæ™¯1ï¼šæ”¯ä»˜æˆåŠŸä½†ç§¯åˆ†æœªåˆ°è´¦

```sql
-- æŸ¥è¯¢è®¢å•
SELECT * FROM credit_orders WHERE order_number = 'VEO1234567890';

-- æ‰‹åŠ¨ç»™ç”¨æˆ·å……å€¼
INSERT INTO credit_transactions (
  user_id, type, amount, description, 
  balance_before, balance_after, created_at
) VALUES (
  'user_id_here',
  'MANUAL_CREDIT',
  50,
  'æ‰‹åŠ¨è¡¥å……ç§¯åˆ† - è®¢å•VEO1234567890',
  (SELECT available_credits FROM user_credit_accounts WHERE user_id = 'user_id_here'),
  (SELECT available_credits FROM user_credit_accounts WHERE user_id = 'user_id_here') + 50,
  NOW()
);

-- æ›´æ–°ç§¯åˆ†è´¦æˆ·
UPDATE user_credit_accounts
SET available_credits = available_credits + 50,
    total_credits = total_credits + 50
WHERE user_id = 'user_id_here';
```

#### åœºæ™¯2ï¼šé€€æ¬¾å¤„ç†

**ä½¿ç”¨é€€æ¬¾API**:
```bash
curl -X POST https://yourdomain.com/api/payment/alipay/refund \
  -H "Content-Type: application/json" \
  -d '{
    "orderId": "order_uuid_here",
    "refundReason": "ç”¨æˆ·ç”³è¯·é€€æ¬¾"
  }'
```

**æ‰‹åŠ¨é€€æ¬¾**ï¼ˆä»…åœ¨APIå¤±è´¥æ—¶ä½¿ç”¨ï¼‰:
```sql
-- 1. æ‰£é™¤ç”¨æˆ·ç§¯åˆ†
UPDATE user_credit_accounts
SET available_credits = available_credits - 50
WHERE user_id = 'user_id_here';

-- 2. æ›´æ–°è®¢å•çŠ¶æ€
UPDATE credit_orders
SET refund_status = 'REFUNDED',
    refund_at = NOW(),
    refund_reason = 'æ‰‹åŠ¨é€€æ¬¾'
WHERE id = 'order_uuid_here';

-- 3. è®°å½•äº¤æ˜“
INSERT INTO credit_transactions (...)
```

---

## ç”¨æˆ·ç®¡ç†

### æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯

```sql
-- æŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
SELECT 
  u.id,
  u.email,
  u.name,
  u.created_at,
  uca.available_credits,
  uca.total_credits,
  uca.used_credits
FROM users u
LEFT JOIN user_credit_accounts uca ON u.id = uca.user_id
ORDER BY u.created_at DESC
LIMIT 50;

-- æŸ¥è¯¢æ´»è·ƒç”¨æˆ·ï¼ˆæœ€è¿‘7å¤©æœ‰ç”Ÿæˆè§†é¢‘ï¼‰
SELECT DISTINCT u.email, u.name, COUNT(vg.id) as video_count
FROM users u
JOIN video_generations vg ON u.id = vg.user_id
WHERE vg.created_at > NOW() - INTERVAL '7 days'
GROUP BY u.id, u.email, u.name
ORDER BY video_count DESC;
```

### æ‰‹åŠ¨ç»™ç”¨æˆ·å……å€¼ç§¯åˆ†

```sql
-- å……å€¼50ç§¯åˆ†
UPDATE user_credit_accounts
SET available_credits = available_credits + 50,
    total_credits = total_credits + 50
WHERE user_id = 'user_id_here';

-- è®°å½•äº¤æ˜“
INSERT INTO credit_transactions (
  user_id, type, amount, description,
  balance_before, balance_after, created_at
) VALUES (
  'user_id_here',
  'MANUAL_CREDIT',
  50,
  'ç®¡ç†å‘˜æ‰‹åŠ¨å……å€¼',
  (SELECT available_credits FROM user_credit_accounts WHERE user_id = 'user_id_here') - 50,
  (SELECT available_credits FROM user_credit_accounts WHERE user_id = 'user_id_here'),
  NOW()
);
```

### å°ç¦ç”¨æˆ·ï¼ˆå¦‚æœ‰æ»¥ç”¨ï¼‰

```sql
-- ç¦ç”¨ç”¨æˆ·è´¦æˆ·ï¼ˆéœ€è¦å…ˆæ·»åŠ is_activeå­—æ®µï¼‰
-- ALTER TABLE users ADD COLUMN is_active BOOLEAN DEFAULT true;

UPDATE users
SET is_active = false
WHERE email = 'abuser@example.com';
```

---

## å†…å®¹å®¡æ ¸

### å®¡æ ¸ç”¨æˆ·ç”Ÿæˆçš„è§†é¢‘

```sql
-- æŸ¥çœ‹æœ€æ–°ç”Ÿæˆçš„è§†é¢‘
SELECT 
  vg.id,
  u.email,
  vg.prompt,
  vg.status,
  vg.video_url,
  vg.created_at
FROM video_generations vg
JOIN users u ON vg.user_id = u.id
ORDER BY vg.created_at DESC
LIMIT 50;

-- æŸ¥æ‰¾å¯ç–‘å†…å®¹ï¼ˆåŒ…å«å…³é”®è¯ï¼‰
SELECT * FROM video_generations
WHERE prompt ILIKE '%æ•æ„Ÿè¯%'
ORDER BY created_at DESC;
```

### åˆ é™¤è¿è§„å†…å®¹

```sql
-- åˆ é™¤è§†é¢‘è®°å½•
DELETE FROM video_generations
WHERE id = 'video_id_here';

-- å¦‚æœåœ¨å±•ç¤ºå»Šï¼Œä¹Ÿåˆ é™¤
DELETE FROM gallery_videos
WHERE generation_id = 'video_id_here';
```

---

## æ•°æ®ç»Ÿè®¡

### æ¯æ—¥æ•°æ®

```sql
-- ä»Šæ—¥æ³¨å†Œç”¨æˆ·
SELECT COUNT(*) FROM users
WHERE DATE(created_at) = CURRENT_DATE;

-- ä»Šæ—¥è®¢å•å’Œæ”¶å…¥
SELECT 
  COUNT(*) as order_count,
  SUM(CASE WHEN status = 'PAID' THEN amount ELSE 0 END) as revenue
FROM credit_orders
WHERE DATE(created_at) = CURRENT_DATE;

-- ä»Šæ—¥è§†é¢‘ç”Ÿæˆé‡
SELECT COUNT(*) FROM video_generations
WHERE DATE(created_at) = CURRENT_DATE;
```

### æœˆåº¦æ•°æ®

```sql
-- æœ¬æœˆæ”¶å…¥
SELECT 
  DATE(created_at) as date,
  COUNT(*) as orders,
  SUM(amount) as revenue
FROM credit_orders
WHERE status = 'PAID'
AND created_at >= DATE_TRUNC('month', CURRENT_DATE)
GROUP BY DATE(created_at)
ORDER BY date;

-- æœ¬æœˆæ´»è·ƒç”¨æˆ·
SELECT COUNT(DISTINCT user_id) as active_users
FROM video_generations
WHERE created_at >= DATE_TRUNC('month', CURRENT_DATE);
```

### å¥—é¤é”€å”®ç»Ÿè®¡

```sql
-- å¥—é¤é”€å”®æ’è¡Œ
SELECT 
  package_name,
  COUNT(*) as sales,
  SUM(amount) as revenue
FROM credit_orders
WHERE status = 'PAID'
GROUP BY package_name
ORDER BY sales DESC;
```

---

## å®¢æˆ·æœåŠ¡

### å¸¸è§é—®é¢˜

#### 1. ç”¨æˆ·åé¦ˆï¼šç§¯åˆ†æœªåˆ°è´¦

**æ£€æŸ¥æ­¥éª¤**:
```sql
-- 1. æŸ¥è¯¢è®¢å•
SELECT * FROM credit_orders
WHERE user_id = (SELECT id FROM users WHERE email = 'user@example.com')
ORDER BY created_at DESC;

-- 2. æŸ¥è¯¢ç§¯åˆ†è´¦æˆ·
SELECT * FROM user_credit_accounts
WHERE user_id = (SELECT id FROM users WHERE email = 'user@example.com');

-- 3. æŸ¥è¯¢äº¤æ˜“è®°å½•
SELECT * FROM credit_transactions
WHERE user_id = (SELECT id FROM users WHERE email = 'user@example.com')
ORDER BY created_at DESC;
```

**è§£å†³æ–¹æ¡ˆ**:
- å¦‚æœè®¢å•å·²æ”¯ä»˜ä½†æœªå……å€¼ â†’ æ‰‹åŠ¨å……å€¼
- å¦‚æœè®¢å•æœªæ”¯ä»˜ â†’ æé†’ç”¨æˆ·å®Œæˆæ”¯ä»˜
- å¦‚æœæ”¯ä»˜å®å·²æ‰£æ¬¾ä½†è®¢å•æœªæ›´æ–° â†’ è”ç³»æŠ€æœ¯å¤„ç†

#### 2. ç”¨æˆ·åé¦ˆï¼šå…‘æ¢ç æ— æ•ˆ

**æ£€æŸ¥**:
```sql
SELECT * FROM redemption_codes
WHERE code = 'VEO-ABCD-1234';
```

**å¸¸è§åŸå› **:
- å·²è¢«å…‘æ¢ (status = 'REDEEMED')
- å·²è¿‡æœŸ (expires_at < NOW())
- å·²ä½œåºŸ (status = 'VOIDED')
- è¾“å…¥é”™è¯¯ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

#### 3. ç”¨æˆ·åé¦ˆï¼šè§†é¢‘ç”Ÿæˆå¤±è´¥

**æ£€æŸ¥**:
```sql
SELECT * FROM video_generations
WHERE user_id = (SELECT id FROM users WHERE email = 'user@example.com')
ORDER BY created_at DESC
LIMIT 5;
```

**å¸¸è§åŸå› **:
- VEO APIé”™è¯¯ â†’ æŸ¥çœ‹æ—¥å¿—
- ç§¯åˆ†å·²æ‰£é™¤ä½†è§†é¢‘æœªç”Ÿæˆ â†’ æ‰‹åŠ¨é€€å›ç§¯åˆ†
- å‚è€ƒå›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ â†’ æç¤ºç”¨æˆ·

---

## å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜1ï¼šæœåŠ¡å™¨CPU/å†…å­˜è¿‡é«˜

```bash
# æŸ¥çœ‹è¿›ç¨‹
pm2 list

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# é‡å¯åº”ç”¨
pm2 restart veo-ai-platform

# å¦‚æœä»ç„¶é«˜ï¼Œå¯èƒ½éœ€è¦æ‰©å®¹
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥æ•°è¿‡å¤š

```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥
SELECT COUNT(*) FROM pg_stat_activity;

-- æ€æ­»ç©ºé—²è¿æ¥
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE state = 'idle'
AND state_change < NOW() - INTERVAL '10 minutes';
```

### é—®é¢˜3ï¼šæ”¯ä»˜å›è°ƒå¤±è´¥

```bash
# æŸ¥çœ‹æ”¯ä»˜å›è°ƒæ—¥å¿—
tail -f /var/log/veo/out.log | grep "payment"

# æ‰‹åŠ¨è§¦å‘è®¢å•æ£€æŸ¥
# ï¼ˆéœ€è¦å¼€å‘å¯¹åº”çš„ç®¡ç†APIï¼‰
```

### é—®é¢˜4ï¼šNginx 502é”™è¯¯

```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
pm2 status

# é‡å¯åº”ç”¨
pm2 restart veo-ai-platform

# æ£€æŸ¥Nginx
sudo nginx -t
sudo systemctl restart nginx
```

---

## æ•°æ®å¤‡ä»½å’Œæ¢å¤

### æ‰‹åŠ¨å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
pg_dump -U veo_user veo_production > backup_$(date +%Y%m%d).sql

# å‹ç¼©å¤‡ä»½
gzip backup_$(date +%Y%m%d).sql
```

### æ¢å¤æ•°æ®åº“

```bash
# è§£å‹å¤‡ä»½
gunzip backup_20240101.sql.gz

# æ¢å¤
psql -U veo_user veo_production < backup_20240101.sql
```

---

## ç´§æ€¥è”ç³»æ–¹å¼

**æŠ€æœ¯æ”¯æŒ**: 
- é‚®ç®±: support@yourdomain.com
- ç”µè¯: xxx-xxxx-xxxx

**æœåŠ¡å™¨æä¾›å•†**:
- é˜¿é‡Œäº‘/è…¾è®¯äº‘/AWS æ§åˆ¶å°

**æ•°æ®åº“**:
- Supabase Dashboard: https://app.supabase.com

---

## æ—¥å¸¸æ£€æŸ¥æ¸…å•

### æ¯æ—¥æ£€æŸ¥ï¼ˆ5åˆ†é’Ÿï¼‰

- [ ] æŸ¥çœ‹PM2çŠ¶æ€
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- [ ] æŸ¥çœ‹ä»Šæ—¥è®¢å•å’Œæ”¶å…¥
- [ ] æŸ¥çœ‹ä»Šæ—¥æ–°å¢ç”¨æˆ·
- [ ] æŸ¥çœ‹æœåŠ¡å™¨èµ„æºä½¿ç”¨ç‡

### æ¯å‘¨æ£€æŸ¥ï¼ˆ30åˆ†é’Ÿï¼‰

- [ ] å®¡æ ¸ç”¨æˆ·ç”Ÿæˆçš„è§†é¢‘
- [ ] æ¸…ç†è¿‡æœŸè®¢å•
- [ ] æŸ¥çœ‹æ•°æ®åº“æ…¢æŸ¥è¯¢
- [ ] æ£€æŸ¥å¤‡ä»½æ˜¯å¦æ­£å¸¸
- [ ] æ›´æ–°ç³»ç»Ÿå’Œä¾èµ–

### æ¯æœˆæ£€æŸ¥ï¼ˆ1å°æ—¶ï¼‰

- [ ] æ•°æ®ç»Ÿè®¡åˆ†æ
- [ ] ç”¨æˆ·åé¦ˆæ•´ç†
- [ ] ä¼˜åŒ–å»ºè®®æ”¶é›†
- [ ] æˆæœ¬æ ¸ç®—
- [ ] å¤‡ä»½æµ‹è¯•æ¢å¤

---

**è¿è¥æ„‰å¿«ï¼** å¦‚æœ‰é—®é¢˜ï¼Œè¯·éšæ—¶æŸ¥é˜…æœ¬æ‰‹å†Œæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚



