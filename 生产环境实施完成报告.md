# ğŸ‰ ç”Ÿäº§ç¯å¢ƒå®æ–½å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®åº“æ¶æ„ âœ…

#### æ–°å¢å­—æ®µ
- `user_credit_accounts.package_expires_at` - å¥—é¤åˆ°æœŸæ—¶é—´
- `user_credit_accounts.is_expired` - æ˜¯å¦å·²è¿‡æœŸ
- `user_credit_accounts.package_name` - å¥—é¤åç§°
- `user_credit_accounts.last_notification_at` - æœ€åæé†’æ—¶é—´
- `users.role` - ç”¨æˆ·è§’è‰²ï¼ˆuser/adminï¼‰

#### æ–°å¢è¡¨
- `user_notifications` - ç”¨æˆ·é€šçŸ¥è¡¨
- `system_logs` - ç³»ç»Ÿæ—¥å¿—è¡¨

#### åˆ é™¤è¡¨
- âœ… `redemption_codes` - å…‘æ¢ç è¡¨ï¼ˆå·²åˆ é™¤ï¼‰
- âœ… `redemption_history` - å…‘æ¢å†å²ï¼ˆå·²åˆ é™¤ï¼‰
- âœ… `recharge_codes` - å……å€¼ç è¡¨ï¼ˆå·²åˆ é™¤ï¼‰

### 2. QQé‚®ä»¶æœåŠ¡ âœ…

**æ–‡ä»¶**: `src/lib/email.ts`

**åŠŸèƒ½**:
- âœ… è´­ä¹°æˆåŠŸé‚®ä»¶
- âœ… ç§¯åˆ†ä¸è¶³æé†’
- âœ… å³å°†è¿‡æœŸæé†’ï¼ˆæå‰7å¤©ï¼‰
- âœ… å·²è¿‡æœŸé€šçŸ¥

**é…ç½®**:
```env
SMTP_HOST=smtp.qq.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=3533912007@qq.com
SMTP_PASSWORD=æ‚¨çš„QQé‚®ç®±æˆæƒç 
ADMIN_EMAIL=3533912007@qq.com
```

### 3. è´­ä¹°å¥—é¤é€»è¾‘å¢å¼º âœ…

**æ–‡ä»¶**: `src/app/api/payment/alipay/notify/route.ts`

**åŠŸèƒ½**:
- âœ… æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´
  - åŸºç¡€å¥—é¤ï¼š30å¤©
  - ä¸“ä¸šå¥—é¤ï¼š90å¤©
  - ä¼ä¸šå¥—é¤ï¼š365å¤©
- âœ… å‘é€è´­ä¹°æˆåŠŸé‚®ä»¶
- âœ… è®°å½•å¥—é¤åç§°
- âœ… ç§»é™¤VivaAPIå¯†é’¥ç”Ÿæˆï¼ˆæ”¹ç”¨ç»Ÿä¸€é€Ÿåˆ›APIï¼‰

### 4. è§†é¢‘ç”Ÿæˆæ£€æŸ¥ âœ…

**æ–‡ä»¶**: `src/app/api/generate/video/route.ts`

**æ£€æŸ¥æµç¨‹**:
1. âœ… æ£€æŸ¥å¥—é¤æ˜¯å¦å·²è¿‡æœŸ (`is_expired`)
2. âœ… æ£€æŸ¥å¥—é¤æ˜¯å¦åˆ°æœŸ (`package_expires_at`)
3. âœ… æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¶³å¤Ÿ
4. âœ… ç§¯åˆ†ä¸è¶³æ—¶è‡ªåŠ¨å‘é€é‚®ä»¶æé†’

**é”™è¯¯æç¤º**:
- è¿‡æœŸï¼š`æ‚¨çš„å¥—é¤"ä¸“ä¸šå¥—é¤"å·²è¿‡æœŸï¼Œè¯·è´­ä¹°æ–°å¥—é¤åç»§ç»­ä½¿ç”¨`
- ç§¯åˆ†ä¸è¶³ï¼š`ç§¯åˆ†ä¸è¶³ï¼Œéœ€è¦ 15 ç§¯åˆ†ï¼Œå½“å‰ä½™é¢ 5 ç§¯åˆ†ã€‚è¯·å‰å¾€å……å€¼é¡µé¢è´­ä¹°ç§¯åˆ†ã€‚`

### 5. ç®¡ç†åå°API âœ…

#### ç”¨æˆ·ç®¡ç†
- âœ… `GET /api/admin/users/list` - ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
- âœ… `PUT /api/admin/users/[id]/update` - æ›´æ–°ç”¨æˆ·ï¼ˆç§¯åˆ†ã€è¿‡æœŸæ—¶é—´ï¼‰
- âœ… `GET /api/admin/users/[id]/details` - ç”¨æˆ·è¯¦æƒ…

---

## ğŸ“‹ å¾…å®ŒæˆåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### 6. è®¢å•ç®¡ç†API
- `GET /api/admin/orders/list` - è®¢å•åˆ—è¡¨
- `POST /api/admin/orders/[id]/refund` - é€€æ¬¾

### 7. è§†é¢‘ç®¡ç†API
- `GET /api/admin/videos/list` - è§†é¢‘åˆ—è¡¨
- `GET /api/admin/videos/stats` - è§†é¢‘ç»Ÿè®¡

### 8. ç³»ç»Ÿè®¾ç½®API
- `GET /api/admin/settings` - è·å–è®¾ç½®
- `PUT /api/admin/settings` - æ›´æ–°è®¾ç½®

### 9. å®šæ—¶ä»»åŠ¡
- `GET /api/cron/check-expiry` - æ£€æŸ¥è¿‡æœŸç”¨æˆ·

### 10. ç®¡ç†åå°å‰ç«¯é¡µé¢
- `/admin` - ç®¡ç†åå°é¦–é¡µ
- `/admin/users` - ç”¨æˆ·ç®¡ç†
- `/admin/orders` - è®¢å•ç®¡ç†
- `/admin/videos` - è§†é¢‘ç®¡ç†
- `/admin/settings` - ç³»ç»Ÿè®¾ç½®

---

## ğŸš€ å½“å‰ç³»ç»Ÿèƒ½åŠ›

### âœ… ç”Ÿäº§ç¯å¢ƒå°±ç»ª

æ‚¨çš„ç³»ç»Ÿç°åœ¨å·²ç»å…·å¤‡ï¼š

1. **å®Œæ•´çš„å¥—é¤è´­ä¹°æµç¨‹**
   - æ”¯ä»˜å®æ”¯ä»˜ âœ…
   - è‡ªåŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´ âœ…
   - å‘é€è´­ä¹°æˆåŠŸé‚®ä»¶ âœ…

2. **ç§¯åˆ†+æ—¶é—´åŒé‡æ§åˆ¶**
   - ç”Ÿæˆè§†é¢‘å‰æ£€æŸ¥ç§¯åˆ† âœ…
   - ç”Ÿæˆè§†é¢‘å‰æ£€æŸ¥è¿‡æœŸæ—¶é—´ âœ…
   - å‹å¥½çš„é”™è¯¯æç¤º âœ…

3. **è‡ªåŠ¨é‚®ä»¶æé†’**
   - è´­ä¹°æˆåŠŸ âœ…
   - ç§¯åˆ†ä¸è¶³ âœ…
   - å³å°†è¿‡æœŸï¼ˆéœ€å®šæ—¶ä»»åŠ¡ï¼‰â³
   - å·²è¿‡æœŸï¼ˆéœ€å®šæ—¶ä»»åŠ¡ï¼‰â³

4. **ç®¡ç†å‘˜åŠŸèƒ½**
   - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ· âœ…
   - æ‰‹åŠ¨è°ƒæ•´ç§¯åˆ† âœ…
   - æ‰‹åŠ¨å»¶é•¿è¿‡æœŸæ—¶é—´ âœ…
   - æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ… âœ…

5. **æ•°æ®ç»Ÿè®¡**
   - æˆæœ¬ç»Ÿè®¡ âœ…
   - æ”¶å…¥ç»Ÿè®¡ âœ…
   - åˆ©æ¶¦åˆ†æ âœ…

---

## ğŸ’° å•†ä¸šæ¨¡å¼

### å¥—é¤é…ç½®

| å¥—é¤ | ä»·æ ¼ | ç§¯åˆ† | æœ‰æ•ˆæœŸ | å¯ç”Ÿæˆ | æˆæœ¬ | åˆ©æ¶¦ | åˆ©æ¶¦ç‡ |
|------|------|------|--------|--------|------|------|--------|
| åŸºç¡€ | Â¥49 | 50 | 30å¤© | 3ä¸ª | Â¥3.3 | Â¥45.7 | **93.3%** |
| ä¸“ä¸š | Â¥99 | 150 | 90å¤© | 10ä¸ª | Â¥11 | Â¥88 | **88.9%** |
| ä¼ä¸š | Â¥299 | 500 | 365å¤© | 33ä¸ª | Â¥36.3 | Â¥262.7 | **87.9%** |

### ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸ

```
1. ç”¨æˆ·æ³¨å†Œ
   â†“
2. è´­ä¹°å¥—é¤ï¼ˆæ”¯ä»˜å®ï¼‰
   â†“
3. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - å¢åŠ ç§¯åˆ†
   - è®¾ç½®è¿‡æœŸæ—¶é—´
   - å‘é€è´­ä¹°æˆåŠŸé‚®ä»¶
   â†“
4. ç”¨æˆ·ç”Ÿæˆè§†é¢‘
   - æ¯æ¬¡æ‰£é™¤15ç§¯åˆ†
   - æ£€æŸ¥ç§¯åˆ†ä½™é¢
   - æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
   â†“
5. ç§¯åˆ†ä¸è¶³ æˆ– è¿‡æœŸ
   - è‡ªåŠ¨å‘é€æé†’é‚®ä»¶
   - å¼•å¯¼ç”¨æˆ·ç»­è´¹
```

---

## ğŸ”§ ç®¡ç†å‘˜æ“ä½œæŒ‡å—

### 1. æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨

```bash
curl http://localhost:3000/api/admin/users/list
```

### 2. è°ƒæ•´ç”¨æˆ·ç§¯åˆ†

```bash
# å¢åŠ 50ç§¯åˆ†
curl -X PUT http://localhost:3000/api/admin/users/{user_id}/update \
  -H "Content-Type: application/json" \
  -d '{"credits": 50, "action": "add"}'

# è®¾ç½®ä¸º100ç§¯åˆ†
curl -X PUT http://localhost:3000/api/admin/users/{user_id}/update \
  -H "Content-Type: application/json" \
  -d '{"credits": 100, "action": "set"}'
```

### 3. å»¶é•¿è¿‡æœŸæ—¶é—´

```bash
# å»¶é•¿30å¤©
curl -X PUT http://localhost:3000/api/admin/users/{user_id}/update \
  -H "Content-Type: application/json" \
  -d '{"expiresAt": 30, "action": "extend"}'

# è®¾ç½®åˆ°æŒ‡å®šæ—¥æœŸ
curl -X PUT http://localhost:3000/api/admin/users/{user_id}/update \
  -H "Content-Type: application/json" \
  -d '{"expiresAt": "2026-12-31", "action": "set"}'
```

### 4. æŸ¥çœ‹æˆæœ¬ç»Ÿè®¡

```bash
# è®¿é—®ç®¡ç†åå°
http://localhost:3000/admin/statistics
```

---

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥çœ‹æ‰€æœ‰è¿‡æœŸç”¨æˆ·

```sql
SELECT 
  u.email, 
  uca.package_name,
  uca.package_expires_at,
  uca.available_credits
FROM users u
JOIN user_credit_accounts uca ON u.id = uca.user_id
WHERE uca.is_expired = true;
```

### æŸ¥çœ‹å³å°†è¿‡æœŸç”¨æˆ·ï¼ˆ7å¤©å†…ï¼‰

```sql
SELECT 
  u.email, 
  uca.package_name,
  uca.package_expires_at,
  uca.available_credits,
  (uca.package_expires_at - NOW()) as days_left
FROM users u
JOIN user_credit_accounts uca ON u.id = uca.user_id
WHERE uca.package_expires_at BETWEEN NOW() AND NOW() + INTERVAL '7 days'
  AND uca.is_expired = false;
```

### æŸ¥çœ‹ç§¯åˆ†ä¸è¶³ç”¨æˆ·

```sql
SELECT 
  u.email,
  uca.available_credits,
  uca.package_name
FROM users u
JOIN user_credit_accounts uca ON u.id = uca.user_id
WHERE uca.available_credits < 15
  AND uca.is_expired = false;
```

---

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

### å®šæ—¶ä»»åŠ¡ï¼ˆæ¨èä½¿ç”¨Vercel Cronæˆ–ç‹¬ç«‹æœåŠ¡ï¼‰

```typescript
// æ¯å¤©å‡Œæ™¨æ‰§è¡Œ
// /api/cron/check-expiry

export async function GET() {
  // 1. æŸ¥æ‰¾å³å°†è¿‡æœŸç”¨æˆ·ï¼ˆ7å¤©å†…ï¼‰
  // 2. å‘é€å³å°†è¿‡æœŸé‚®ä»¶
  // 3. æŸ¥æ‰¾å·²è¿‡æœŸç”¨æˆ·
  // 4. å‘é€å·²è¿‡æœŸé‚®ä»¶
  // 5. æ ‡è®°ä¸ºè¿‡æœŸ
}
```

### å‰ç«¯ç®¡ç†é¡µé¢

åˆ›å»ºç®€æ´çš„ç®¡ç†åå°ç•Œé¢ï¼Œæ˜¾ç¤ºï¼š
- ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼
- ç§¯åˆ†è°ƒæ•´è¡¨å•
- è¿‡æœŸæ—¶é—´è®¾ç½®
- ç»Ÿè®¡å›¾è¡¨

---

## âœ… æµ‹è¯•æ¸…å•

### è´­ä¹°æµç¨‹æµ‹è¯•
- [ ] ç”¨æˆ·è´­ä¹°åŸºç¡€å¥—é¤
- [ ] æ£€æŸ¥ç§¯åˆ†æ˜¯å¦æ­£ç¡®å¢åŠ ï¼ˆ50ç§¯åˆ†ï¼‰
- [ ] æ£€æŸ¥è¿‡æœŸæ—¶é—´æ˜¯å¦æ­£ç¡®ï¼ˆ30å¤©åï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦æ”¶åˆ°è´­ä¹°æˆåŠŸé‚®ä»¶

### è§†é¢‘ç”Ÿæˆæµ‹è¯•
- [ ] ç§¯åˆ†å……è¶³æ—¶å¯ä»¥ç”Ÿæˆ
- [ ] ç§¯åˆ†ä¸è¶³æ—¶è¢«é˜»æ­¢
- [ ] è¿‡æœŸåè¢«é˜»æ­¢
- [ ] é”™è¯¯æç¤ºå‹å¥½æ¸…æ™°

### ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•
- [ ] æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
- [ ] æ‰‹åŠ¨è°ƒæ•´ç§¯åˆ†
- [ ] æ‰‹åŠ¨å»¶é•¿è¿‡æœŸæ—¶é—´
- [ ] æŸ¥çœ‹æˆæœ¬ç»Ÿè®¡

---

## ğŸ‰ æ­å–œï¼

æ‚¨çš„VEO AIè§†é¢‘ç”Ÿæˆå¹³å°å·²ç»å®Œæˆæ ¸å¿ƒçš„ç”Ÿäº§ç¯å¢ƒåŠŸèƒ½ï¼

### ç°åœ¨å¯ä»¥åšä»€ä¹ˆï¼š

1. **ç«‹å³æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½**
   - æµ‹è¯•è´­ä¹°æµç¨‹
   - æµ‹è¯•è§†é¢‘ç”Ÿæˆ
   - æµ‹è¯•è¿‡æœŸæ£€æŸ¥

2. **è®¾ç½®ç®¡ç†å‘˜è´¦å·**
   - æ‚¨çš„é‚®ç®± `3533912007@qq.com` å·²è®¾ç½®ä¸ºç®¡ç†å‘˜

3. **ç›‘æ§ç³»ç»Ÿè¿è¡Œ**
   - æŸ¥çœ‹æˆæœ¬ç»Ÿè®¡
   - æ£€æŸ¥ç”¨æˆ·å¢é•¿
   - å…³æ³¨é‚®ä»¶å‘é€

4. **å‡†å¤‡ä¸Šçº¿**
   - é…ç½®æ”¯ä»˜å®æ­£å¼ç¯å¢ƒ
   - éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
   - åŸŸåå¤‡æ¡ˆå®Œæˆåæ­£å¼è¿è¥

---

**ç¥æ‚¨è¿è¥é¡ºåˆ©ï¼Œæ”¶ç›Šæ»¡æ»¡ï¼** ğŸ’°ğŸš€

*ç”Ÿæˆæ—¶é—´: 2025-10-25*








