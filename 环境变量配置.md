# ⚙️ VEO AI平台 - 环境变量配置指南

## 📋 目录

- [快速配置](#快速配置)
- [必需配置](#必需配置)
- [可选配置](#可选配置)
- [VEO API配置](#veo-api配置)
- [安全建议](#安全建议)
- [配置检查](#配置检查)

---

## 🚀 快速配置

### 步骤1：创建`.env`文件

在项目根目录创建`.env`文件：

```bash
# 在项目根目录执行
cd veo-ai-platform
touch .env  # Linux/Mac
# 或
New-Item .env  # Windows PowerShell
```

### 步骤2：复制以下内容到`.env`文件

```env
# ===============================================
# 数据库配置（必需）
# ===============================================
DATABASE_URL="postgresql://postgres:PASSWORD@HOST:5432/postgres"

# ===============================================
# Supabase配置（必需）
# ===============================================
SUPABASE_URL="https://YOUR_PROJECT.supabase.co"
SUPABASE_ANON_KEY="your_anon_key_here"
SUPABASE_SERVICE_KEY="your_service_role_key_here"

# ===============================================
# NextAuth配置（必需）
# ===============================================
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your_random_secret_key_here"

# ===============================================
# VEO 3 API配置（必需）
# ===============================================
VEO_API_URL="https://api.veo3api.ai/api/v1"
VEO_API_KEY="veo_your_actual_api_key_here"

# ===============================================
# 邮件服务（可选）
# ===============================================
RESEND_API_KEY="re_your_resend_api_key"
FROM_EMAIL="noreply@yourdomain.com"

# ===============================================
# 微信登录（可选）
# ===============================================
WECHAT_APP_ID="your_wechat_app_id"
WECHAT_APP_SECRET="your_wechat_app_secret"
```

### 步骤3：填入实际值

将上述模板中的占位符替换为实际值。

---

## ✅ 必需配置

### 1. 数据库配置

#### `DATABASE_URL`

**用途**: PostgreSQL数据库连接字符串

**格式**:
```
postgresql://用户名:密码@主机:端口/数据库名
```

**获取方式**:
1. 登录Supabase控制台
2. 进入项目设置 → Database
3. 找到"Connection String" → "URI"
4. 复制连接字符串

**示例**:
```env
DATABASE_URL="postgresql://postgres:bxbbyffb4y4djTx3@db.hblthmkkdfkzvpywlthq.supabase.co:5432/postgres"
```

---

### 2. Supabase配置

#### `SUPABASE_URL`

**用途**: Supabase项目API URL

**获取方式**:
1. Supabase控制台 → 项目设置 → API
2. 复制"Project URL"

**示例**:
```env
SUPABASE_URL="https://hblthmkkdfkzvpywlthq.supabase.co"
```

#### `SUPABASE_ANON_KEY`

**用途**: 公开的匿名密钥（用于客户端）

**获取方式**:
1. Supabase控制台 → 项目设置 → API
2. 复制"anon public"密钥

**示例**:
```env
SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

#### `SUPABASE_SERVICE_KEY`

**用途**: 服务端密钥（拥有完全权限）

**获取方式**:
1. Supabase控制台 → 项目设置 → API
2. 复制"service_role secret"密钥

⚠️ **重要**: 此密钥拥有完全权限，仅用于服务端，不要泄露！

**示例**:
```env
SUPABASE_SERVICE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

---

### 3. NextAuth配置

#### `NEXTAUTH_URL`

**用途**: 应用的URL地址

**本地开发**:
```env
NEXTAUTH_URL="http://localhost:3000"
```

**生产环境**:
```env
NEXTAUTH_URL="https://your-domain.com"
```

#### `NEXTAUTH_SECRET`

**用途**: JWT加密密钥

**生成方法**:

**方法1: 使用OpenSSL（推荐）**
```bash
openssl rand -base64 32
```

**方法2: 使用Node.js**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

**方法3: 在线生成**
访问: https://generate-secret.vercel.app/32

**示例**:
```env
NEXTAUTH_SECRET="Xy9kL3mP8qR5tU2vW1xY4zA7bC6dE9fG"
```

⚠️ **重要**: 必须至少32个字符！

---

## 🎬 VEO API配置

### `VEO_API_URL`

**用途**: VEO 3 API基础URL

**默认值**: `https://api.veo3api.ai/api/v1`

通常不需要修改，除非VEO官方更改了API地址。

```env
VEO_API_URL="https://api.veo3api.ai/api/v1"
```

### `VEO_API_KEY` ⭐

**用途**: VEO 3 API认证密钥

**这是最重要的配置！** 用于调用真实的VEO视频生成API。

#### 获取步骤：

**1. 注册VEO账号**
- 访问: https://veo3api.ai/zh-CN
- 点击"注册"
- 填写邮箱和密码
- 验证邮箱

**2. 充值积分**
- 登录后台
- 选择充值套餐
- 完成支付
- 建议首次充值100-500积分用于测试

**3. 获取API密钥**
- 导航到"API密钥"页面
- 点击"创建新密钥"
- 复制生成的API密钥

**格式**: `veo_xxxxxxxxxxxxxxxx`

**示例**:
```env
VEO_API_KEY="veo_1a2b3c4d5e6f7g8h9i0j"
```

⚠️ **重要提示**:
- API密钥格式必须以 `veo_` 开头
- 妥善保管，不要分享给他人
- 如果泄露，立即在控制台重新生成

#### 测试API密钥:

创建测试脚本 `test-veo.js`:

```javascript
const VEO_API_KEY = "veo_your_actual_api_key_here"

async function testVEO() {
  const response = await fetch('https://api.veo3api.ai/api/v1/common/credit', {
    headers: { 'Authorization': `Bearer ${VEO_API_KEY}` }
  })
  const result = await response.json()
  console.log('剩余积分:', result.data)
}

testVEO()
```

运行:
```bash
node test-veo.js
```

---

## 🔧 可选配置

### 邮件服务（用于邮箱验证码登录）

#### `RESEND_API_KEY`

**用途**: Resend邮件服务API密钥

**获取方式**:
1. 访问: https://resend.com
2. 注册并登录
3. 创建API密钥

```env
RESEND_API_KEY="re_123456789"
FROM_EMAIL="noreply@yourdomain.com"
```

---

### 微信登录

#### `WECHAT_APP_ID` 和 `WECHAT_APP_SECRET`

**用途**: 微信开放平台认证

**获取方式**:
1. 访问: https://open.weixin.qq.com
2. 注册开发者账号
3. 创建网站应用
4. 获取AppID和AppSecret

```env
WECHAT_APP_ID="wx1234567890abcdef"
WECHAT_APP_SECRET="1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p"
```

---

## 🔒 安全建议

### 1. 保护`.env`文件

**确保`.env`在`.gitignore`中**:

```bash
# 检查.gitignore
cat .gitignore | grep ".env"

# 应该看到:
# .env
# .env.local
# .env*.local
```

### 2. 不同环境使用不同密钥

- **开发环境**: `.env.local`
- **测试环境**: `.env.test`
- **生产环境**: 使用部署平台的环境变量配置

### 3. 定期轮换密钥

建议每3-6个月更换一次：
- `NEXTAUTH_SECRET`
- `VEO_API_KEY`
- 数据库密码

### 4. 最小权限原则

- 开发环境使用测试账号
- 生产环境使用独立的API密钥
- 限制API密钥的权限范围

---

## ✔️ 配置检查

### 检查清单

创建配置检查脚本 `check-env.js`:

```javascript
const fs = require('fs')
const path = require('path')

// 读取.env文件
const envPath = path.join(__dirname, '.env')

if (!fs.existsSync(envPath)) {
  console.error('❌ .env文件不存在！')
  process.exit(1)
}

const envContent = fs.readFileSync(envPath, 'utf-8')

const requiredVars = [
  'DATABASE_URL',
  'SUPABASE_URL',
  'SUPABASE_SERVICE_KEY',
  'NEXTAUTH_SECRET',
  'NEXTAUTH_URL',
  'VEO_API_KEY'
]

const optionalVars = [
  'RESEND_API_KEY',
  'WECHAT_APP_ID',
  'WECHAT_APP_SECRET'
]

console.log('🔍 检查环境变量配置...\n')

let allValid = true

// 检查必需变量
console.log('必需配置:')
requiredVars.forEach(varName => {
  const regex = new RegExp(`${varName}=["']?(.+?)["']?$`, 'm')
  const match = envContent.match(regex)
  
  if (match && match[1] && !match[1].includes('your_') && !match[1].includes('YOUR_')) {
    console.log(`  ✅ ${varName}`)
  } else {
    console.log(`  ❌ ${varName} - 未配置或使用了占位符`)
    allValid = false
  }
})

// 检查可选变量
console.log('\n可选配置:')
optionalVars.forEach(varName => {
  const regex = new RegExp(`${varName}=["']?(.+?)["']?$`, 'm')
  const match = envContent.match(regex)
  
  if (match && match[1] && !match[1].includes('your_')) {
    console.log(`  ✅ ${varName}`)
  } else {
    console.log(`  ⚠️  ${varName} - 未配置`)
  }
})

// 特殊检查
console.log('\n特殊检查:')

// 检查NEXTAUTH_SECRET长度
const secretMatch = envContent.match(/NEXTAUTH_SECRET=["']?(.+?)["']?$/m)
if (secretMatch && secretMatch[1].length >= 32) {
  console.log('  ✅ NEXTAUTH_SECRET长度符合要求 (>=32)')
} else {
  console.log('  ❌ NEXTAUTH_SECRET长度不足 (需要>=32字符)')
  allValid = false
}

// 检查VEO_API_KEY格式
const veoKeyMatch = envContent.match(/VEO_API_KEY=["']?(.+?)["']?$/m)
if (veoKeyMatch && veoKeyMatch[1].startsWith('veo_')) {
  console.log('  ✅ VEO_API_KEY格式正确')
} else {
  console.log('  ❌ VEO_API_KEY格式错误 (应以veo_开头)')
  allValid = false
}

console.log('\n' + '='.repeat(50))
if (allValid) {
  console.log('✅ 所有必需配置正确！')
  console.log('\n下一步: npm run dev')
} else {
  console.log('❌ 配置有误，请检查并修正')
  process.exit(1)
}
```

运行检查:
```bash
node check-env.js
```

---

## 📚 相关文档

- [VEO API集成指南](VEO_API集成指南.md)
- [快速部署指南](快速部署指南.md)
- [项目完成总结](项目完成总结.md)

---

## 🆘 遇到问题？

### 常见错误

**1. "Invalid Compact JWS"**
- 原因: `NEXTAUTH_SECRET`未设置或太短
- 解决: 生成新的32+字符密钥

**2. "Database connection failed"**
- 原因: `DATABASE_URL`错误
- 解决: 检查连接字符串格式和密码

**3. "VEO API密钥未配置"**
- 原因: `VEO_API_KEY`未设置
- 解决: 从VEO控制台获取API密钥

**4. "Supabase bucket not found"**
- 原因: `SUPABASE_SERVICE_KEY`错误
- 解决: 使用service_role密钥，不是anon密钥

### 获取帮助

如需帮助，请：
1. 检查配置文档
2. 运行配置检查脚本
3. 查看日志文件
4. 联系技术支持

---

**配置完成后，运行 `npm run dev` 启动开发服务器！** 🚀



