# ğŸ‰ QQé‚®ç®±ç™»å½•åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. éªŒè¯ç å‘é€ç³»ç»Ÿ âœ…

**API**: `POST /api/auth/send-code`

**åŠŸèƒ½**:
- âœ… æ”¯æŒä»»ä½•é‚®ç®±æ ¼å¼ï¼ˆåŒ…æ‹¬QQé‚®ç®±ï¼‰
- âœ… è‡ªåŠ¨æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆé¦–æ¬¡ç™»å½•è‡ªåŠ¨åˆ›å»ºè´¦å·ï¼‰
- âœ… ç”Ÿæˆ6ä½éšæœºæ•°å­—éªŒè¯ç 
- âœ… éªŒè¯ç æœ‰æ•ˆæœŸ5åˆ†é’Ÿ
- âœ… è‡ªåŠ¨æ¸…é™¤æ—§éªŒè¯ç 
- âœ… å‘é€ç²¾ç¾HTMLé‚®ä»¶

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:3000/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"email": "3533912007@qq.com"}'
```

**å“åº”**:
```json
{
  "success": true,
  "message": "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶"
}
```

### 2. éªŒè¯ç é‚®ä»¶æ¨¡æ¿ âœ…

**æ–‡ä»¶**: `src/lib/email.ts`

**ç‰¹ç‚¹**:
- âœ… ç°ä»£åŒ–è®¾è®¡ï¼ˆæ¸å˜è‰²èƒŒæ™¯ï¼‰
- âœ… å¤§å·éªŒè¯ç æ˜¾ç¤ºï¼ˆ36pxï¼Œæ˜“è¯»ï¼‰
- âœ… è™šçº¿è¾¹æ¡†å¼ºè°ƒ
- âœ… å®‰å…¨æç¤ºï¼ˆé˜²æ­¢é’“é±¼ï¼‰
- âœ… æœ‰æ•ˆæœŸæé†’

**é‚®ä»¶é¢„è§ˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ” ç™»å½•éªŒè¯ç           â”‚
â”‚   VEO AI è§†é¢‘ç”Ÿæˆå¹³å°    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚
â”‚  æ‚¨çš„éªŒè¯ç æ˜¯ï¼š           â”‚
â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   123456       â”‚      â”‚
â”‚  â”‚  (5åˆ†é’Ÿæœ‰æ•ˆ)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                           â”‚
â”‚  âš ï¸ å®‰å…¨æç¤ºï¼š            â”‚
â”‚  â€¢ è¯·å‹¿å‘ŠçŸ¥ä»–äºº           â”‚
â”‚  â€¢ å¦‚éæœ¬äººæ“ä½œï¼Œè¯·å¿½ç•¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. NextAuthé›†æˆ âœ…

**æ–‡ä»¶**: `src/lib/auth.ts`

**å·²æœ‰é…ç½®**:
- âœ… `email-code` Providerï¼ˆé‚®ç®±éªŒè¯ç ç™»å½•ï¼‰
- âœ… è‡ªåŠ¨éªŒè¯éªŒè¯ç 
- âœ… éªŒè¯æˆåŠŸè‡ªåŠ¨ç™»å½•

**ç™»å½•æµç¨‹**:
```
1. ç”¨æˆ·è¾“å…¥é‚®ç®±
   â†“
2. ç‚¹å‡»"å‘é€éªŒè¯ç "
   â†“
3. ç³»ç»Ÿæ£€æŸ¥ç”¨æˆ·
   - å­˜åœ¨ï¼šå‘é€éªŒè¯ç 
   - ä¸å­˜åœ¨ï¼šè‡ªåŠ¨æ³¨å†Œ + å‘é€éªŒè¯ç 
   â†“
4. ç”¨æˆ·è¾“å…¥éªŒè¯ç 
   â†“
5. ç³»ç»ŸéªŒè¯
   â†“
6. ç™»å½•æˆåŠŸ
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
// 1. å‘é€éªŒè¯ç 
const sendCode = async (email: string) => {
  const response = await fetch('/api/auth/send-code', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email })
  })
  
  const data = await response.json()
  
  if (data.success) {
    alert('éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥æ”¶é‚®ç®±')
  } else {
    alert(data.error)
  }
}

// 2. éªŒè¯ç ç™»å½•
const loginWithCode = async (email: string, code: string) => {
  const result = await signIn('email-code', {
    email,
    code,
    redirect: false
  })
  
  if (result?.ok) {
    // ç™»å½•æˆåŠŸ
    router.push('/dashboard')
  } else {
    alert('éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ')
  }
}
```

### Reactç»„ä»¶ç¤ºä¾‹

```tsx
'use client'

import { useState } from 'react'
import { signIn } from 'next-auth/react'

export default function EmailLoginForm() {
  const [email, setEmail] = useState('')
  const [code, setCode] = useState('')
  const [sent, setSent] = useState(false)
  const [loading, setLoading] = useState(false)

  const handleSendCode = async () => {
    setLoading(true)
    try {
      const response = await fetch('/api/auth/send-code', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      })
      
      const data = await response.json()
      
      if (data.success) {
        setSent(true)
        alert('éªŒè¯ç å·²å‘é€ï¼')
      } else {
        alert(data.error)
      }
    } catch (error) {
      alert('å‘é€å¤±è´¥')
    } finally {
      setLoading(false)
    }
  }

  const handleLogin = async () => {
    setLoading(true)
    try {
      const result = await signIn('email-code', {
        email,
        code,
        redirect: false
      })
      
      if (result?.ok) {
        window.location.href = '/dashboard'
      } else {
        alert('éªŒè¯ç é”™è¯¯')
      }
    } catch (error) {
      alert('ç™»å½•å¤±è´¥')
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-4">
      {/* é‚®ç®±è¾“å…¥ */}
      <div>
        <label>QQé‚®ç®±</label>
        <input
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="è¯·è¾“å…¥QQé‚®ç®±"
          className="w-full p-2 border rounded"
        />
      </div>

      {/* å‘é€éªŒè¯ç æŒ‰é’® */}
      {!sent && (
        <button
          onClick={handleSendCode}
          disabled={loading || !email}
          className="w-full bg-blue-600 text-white p-2 rounded"
        >
          {loading ? 'å‘é€ä¸­...' : 'å‘é€éªŒè¯ç '}
        </button>
      )}

      {/* éªŒè¯ç è¾“å…¥ */}
      {sent && (
        <>
          <div>
            <label>éªŒè¯ç </label>
            <input
              type="text"
              value={code}
              onChange={(e) => setCode(e.target.value)}
              placeholder="è¯·è¾“å…¥6ä½éªŒè¯ç "
              maxLength={6}
              className="w-full p-2 border rounded"
            />
          </div>
          
          <button
            onClick={handleLogin}
            disabled={loading || !code}
            className="w-full bg-green-600 text-white p-2 rounded"
          >
            {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
          </button>
          
          <button
            onClick={handleSendCode}
            disabled={loading}
            className="w-full text-blue-600"
          >
            é‡æ–°å‘é€éªŒè¯ç 
          </button>
        </>
      )}
    </div>
  )
}
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. éªŒè¯ç å®‰å…¨
- âœ… 6ä½éšæœºæ•°å­—ï¼ˆ100ä¸‡ç§ç»„åˆï¼‰
- âœ… 5åˆ†é’Ÿæœ‰æ•ˆæœŸ
- âœ… ä½¿ç”¨åè‡ªåŠ¨å¤±æ•ˆ
- âœ… æ¯æ¬¡è¯·æ±‚æ¸…é™¤æ—§éªŒè¯ç 

### 2. è‡ªåŠ¨æ³¨å†Œä¿æŠ¤
- âœ… è‡ªåŠ¨åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·
- âœ… åˆå§‹åŒ–ç§¯åˆ†è´¦æˆ·ï¼ˆ0ç§¯åˆ†ï¼‰
- âœ… ä½¿ç”¨é‚®ç®±å‰ç¼€ä½œä¸ºé»˜è®¤ç”¨æˆ·å
- âœ… è®°å½•æ³¨å†Œæ—¶é—´

### 3. é‚®ç®±éªŒè¯
- âœ… æ ¼å¼éªŒè¯ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
- âœ… æ”¯æŒæ‰€æœ‰é‚®ç®±æœåŠ¡å•†
- âœ… ç‰¹åˆ«ä¼˜åŒ–QQé‚®ç®±

---

## ğŸ“Š æ•°æ®åº“è®°å½•

### email_verification_codesè¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | TEXT | ä¸»é”® |
| email | TEXT | é‚®ç®±åœ°å€ |
| code | TEXT | 6ä½éªŒè¯ç  |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ |
| used | BOOLEAN | æ˜¯å¦å·²ä½¿ç”¨ |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

### æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥çœ‹æœ€è¿‘å‘é€çš„éªŒè¯ç 
SELECT 
  email, 
  code, 
  expires_at,
  used,
  created_at
FROM email_verification_codes
ORDER BY created_at DESC
LIMIT 10;

-- æ¸…ç†è¿‡æœŸéªŒè¯ç 
DELETE FROM email_verification_codes
WHERE expires_at < NOW()
   OR used = true;
```

---

## âœ… æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] **å‘é€éªŒè¯ç **
  - [ ] QQé‚®ç®±ï¼ˆ3533912007@qq.comï¼‰
  - [ ] å…¶ä»–é‚®ç®±ï¼ˆæµ‹è¯•é€šç”¨æ€§ï¼‰
  - [ ] æ”¶åˆ°éªŒè¯ç é‚®ä»¶
  - [ ] é‚®ä»¶æ ¼å¼æ­£ç¡®

- [ ] **éªŒè¯ç ç™»å½•**
  - [ ] æ­£ç¡®éªŒè¯ç å¯ä»¥ç™»å½•
  - [ ] é”™è¯¯éªŒè¯ç è¢«æ‹’ç»
  - [ ] è¿‡æœŸéªŒè¯ç è¢«æ‹’ç»
  - [ ] ç™»å½•æˆåŠŸè·³è½¬

- [ ] **è‡ªåŠ¨æ³¨å†Œ**
  - [ ] æ–°é‚®ç®±è‡ªåŠ¨åˆ›å»ºè´¦æˆ·
  - [ ] ç§¯åˆ†è´¦æˆ·è‡ªåŠ¨åˆå§‹åŒ–
  - [ ] ç”¨æˆ·åè‡ªåŠ¨è®¾ç½®

- [ ] **å®‰å…¨æ€§**
  - [ ] éªŒè¯ç 5åˆ†é’Ÿåå¤±æ•ˆ
  - [ ] éªŒè¯ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡
  - [ ] æ—§éªŒè¯ç è‡ªåŠ¨æ¸…é™¤

---

## ğŸ¯ å½“å‰ç™»å½•æ–¹å¼

æ‚¨çš„å¹³å°ç°åœ¨æ”¯æŒ**3ç§ç™»å½•æ–¹å¼**ï¼š

### 1. QQé‚®ç®±éªŒè¯ç ç™»å½• âœ…ï¼ˆæ¨èï¼‰
- æ— éœ€å¯†ç 
- è‡ªåŠ¨æ³¨å†Œ
- å®‰å…¨ä¾¿æ·

### 2. æ™®é€šé‚®ç®±å¯†ç ç™»å½• âœ…
- éœ€è¦è®¾ç½®å¯†ç 
- ä¼ ç»Ÿæ–¹å¼

### 3. å¾®ä¿¡ç™»å½• âœ…
- å¾®ä¿¡æ‰«ç 
- å¿«é€Ÿç™»å½•

---

## ğŸ“§ QQé‚®ç®±SMTPé…ç½®

ç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®ï¼š

```env
SMTP_HOST=smtp.qq.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=3533912007@qq.com
SMTP_PASSWORD=qsrqpjddlctpdaic
```

---

## ğŸš€ ç«‹å³æµ‹è¯•

### æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

2. **æ‰“å¼€æµè§ˆå™¨**
```
http://localhost:3000/login
```

3. **é€‰æ‹©é‚®ç®±ç™»å½•æ–¹å¼**
   - è¾“å…¥ï¼š3533912007@qq.com
   - ç‚¹å‡»ï¼šå‘é€éªŒè¯ç 

4. **æŸ¥æ”¶QQé‚®ç®±**
   - æ‰“å¼€QQé‚®ç®±
   - æ‰¾åˆ°éªŒè¯ç é‚®ä»¶
   - å¤åˆ¶6ä½æ•°å­—

5. **è¾“å…¥éªŒè¯ç **
   - è¾“å…¥æ”¶åˆ°çš„éªŒè¯ç 
   - ç‚¹å‡»ç™»å½•

6. **ç™»å½•æˆåŠŸ**
   - è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ
   - å¼€å§‹ä½¿ç”¨ç³»ç»Ÿ

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **å€’è®¡æ—¶åŠŸèƒ½** - å‘é€éªŒè¯ç å60ç§’å†…ä¸èƒ½é‡å¤å‘é€
2. **é‚®ä»¶é˜Ÿåˆ—** - ä½¿ç”¨é˜Ÿåˆ—ç³»ç»Ÿæé«˜å¯é æ€§
3. **å¤šè¯­è¨€æ”¯æŒ** - é‚®ä»¶æ¨¡æ¿æ”¯æŒå¤šè¯­è¨€

### é•¿æœŸä¼˜åŒ–
1. **çŸ­ä¿¡éªŒè¯ç ** - å¢åŠ æ‰‹æœºå·ç™»å½•æ–¹å¼
2. **ç¤¾äº¤ç™»å½•** - æ”¯æŒGoogleã€GitHubç­‰
3. **ç”Ÿç‰©è¯†åˆ«** - æ”¯æŒæŒ‡çº¹ã€Face ID

---

## ğŸ‰ æ€»ç»“

### âœ… å®Œæˆçš„åŠŸèƒ½

1. **QQé‚®ç®±éªŒè¯ç ç™»å½•** - å®Œæ•´å®ç°
2. **ç²¾ç¾é‚®ä»¶æ¨¡æ¿** - ç°ä»£åŒ–è®¾è®¡
3. **è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ** - é¦–æ¬¡ç™»å½•è‡ªåŠ¨åˆ›å»ºè´¦å·
4. **NextAuthé›†æˆ** - æ— ç¼å¯¹æ¥ç°æœ‰ç³»ç»Ÿ

### ğŸ¯ ç³»ç»Ÿä¼˜åŠ¿

- **é›¶é—¨æ§›** - æ— éœ€æ³¨å†Œï¼Œè¾“å…¥é‚®ç®±å³å¯ç™»å½•
- **å®‰å…¨å¯é ** - éªŒè¯ç 5åˆ†é’Ÿæœ‰æ•ˆï¼Œä½¿ç”¨åå¤±æ•ˆ
- **ä½“éªŒä¼˜ç§€** - ç²¾ç¾é‚®ä»¶æ¨¡æ¿ï¼Œä¸“ä¸šå½¢è±¡
- **å…¼å®¹æ€§å¼º** - æ”¯æŒæ‰€æœ‰é‚®ç®±æœåŠ¡å•†

---

**QQé‚®ç®±ç™»å½•åŠŸèƒ½å·²å®Œæˆï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼** ğŸ“§âœ…

*å®Œæˆæ—¶é—´: 2025-10-25*








