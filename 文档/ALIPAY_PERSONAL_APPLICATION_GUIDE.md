# æ”¯ä»˜å®ä¸ªäººè´¦å·æ”¯ä»˜æ¥å£ç”³è¯·å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å‡†å¤‡é˜¶æ®µ](#å‡†å¤‡é˜¶æ®µ)
2. [æ³¨å†Œå¼€æ”¾å¹³å°è´¦å·](#æ³¨å†Œå¼€æ”¾å¹³å°è´¦å·)
3. [åˆ›å»ºåº”ç”¨](#åˆ›å»ºåº”ç”¨)
4. [é…ç½®å¯†é’¥](#é…ç½®å¯†é’¥)
5. [ç”³è¯·äº§å“åŠŸèƒ½](#ç”³è¯·äº§å“åŠŸèƒ½)
6. [é›†æˆå¼€å‘](#é›†æˆå¼€å‘)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å‡†å¤‡é˜¶æ®µ

### âœ… å¿…å¤‡æ¡ä»¶æ¸…å•

#### 1. ä¸ªäººä¿¡æ¯
- âœ… å®åè®¤è¯çš„æ”¯ä»˜å®è´¦å·
- âœ… èº«ä»½è¯æ­£åé¢ç…§ç‰‡ï¼ˆæ¸…æ™°ï¼‰
- âœ… æ‰‹æŒèº«ä»½è¯ç…§ç‰‡
- âœ… ä¸ªäººæ‰‹æœºå·ï¼ˆç”¨äºæ¥æ”¶éªŒè¯ç ï¼‰

#### 2. ç½‘ç«™ä¿¡æ¯
- âœ… åŸŸåï¼š`veo-ai.site` æˆ– `www.veo-ai.site`
- âœ… **ICPå¤‡æ¡ˆå·ï¼šèœ€ICPå¤‡2025135924å·** â­
- âœ… ç½‘ç«™å·²éƒ¨ç½²å¹¶å¯è®¿é—®ï¼ˆå¿…é¡»ä½¿ç”¨ HTTPSï¼‰
- âœ… ç½‘ç«™åº•éƒ¨å·²æ˜¾ç¤ºå¤‡æ¡ˆå·å¹¶é“¾æ¥åˆ°å·¥ä¿¡éƒ¨ç½‘ç«™

#### 3. ä¸šåŠ¡ææ–™
- âœ… ä¸šåŠ¡è¯´æ˜æ–‡æ¡£ï¼ˆæè¿° VEO AI çš„æœåŠ¡å†…å®¹ï¼‰
- âœ… ç”¨æˆ·åè®®ã€éšç§æ”¿ç­–é¡µé¢é“¾æ¥
- âœ… è”ç³»æ–¹å¼é¡µé¢
- âœ… ç½‘ç«™æˆªå›¾ï¼ˆé¦–é¡µã€æœåŠ¡é¡µé¢ã€åè®®é¡µé¢ï¼‰

#### 4. é¢„æœŸå‡†å¤‡æ—¶é—´
- ææ–™å‡†å¤‡ï¼š1-2 å°æ—¶
- åº”ç”¨åˆ›å»ºï¼š30 åˆ†é’Ÿ
- å®¡æ ¸ç­‰å¾…ï¼š1-3 ä¸ªå·¥ä½œæ—¥
- **æ€»è®¡ï¼šçº¦ 2-4 å¤©**

---

## æ³¨å†Œå¼€æ”¾å¹³å°è´¦å·

### æ­¥éª¤ 1ï¼šè®¿é—®æ”¯ä»˜å®å¼€æ”¾å¹³å°

**ç½‘å€ï¼š** https://open.alipay.com

### æ­¥éª¤ 2ï¼šæ³¨å†Œ/ç™»å½•

1. ç‚¹å‡»å³ä¸Šè§’ã€Œç™»å½•ã€æŒ‰é’®
2. ä½¿ç”¨æ‚¨çš„æ”¯ä»˜å®è´¦å·æ‰«ç ç™»å½•
3. é¦–æ¬¡ç™»å½•ä¼šè¦æ±‚å®Œå–„å¼€å‘è€…ä¿¡æ¯

### æ­¥éª¤ 3ï¼šå®Œå–„å¼€å‘è€…ä¿¡æ¯

**ä¸ªäººå¼€å‘è€…ä¿¡æ¯ï¼š**

```
å¼€å‘è€…ç±»å‹ï¼šä¸ªäººå¼€å‘è€…
çœŸå®å§“åï¼š[æ‚¨çš„çœŸå®å§“å]
èº«ä»½è¯å·ï¼š[æ‚¨çš„èº«ä»½è¯å·]
æ‰‹æœºå·ï¼š[æ‚¨çš„æ‰‹æœºå·]
é‚®ç®±ï¼š[æ‚¨çš„é‚®ç®±ï¼Œå»ºè®®ä½¿ç”¨ 3533912007@qq.com]
```

**æäº¤ææ–™ï¼š**
- ä¸Šä¼ èº«ä»½è¯æ­£é¢ç…§ç‰‡
- ä¸Šä¼ èº«ä»½è¯åé¢ç…§ç‰‡
- ä¸Šä¼ æ‰‹æŒèº«ä»½è¯ç…§ç‰‡ï¼ˆç¡®ä¿äººè„¸ã€èº«ä»½è¯ä¿¡æ¯æ¸…æ™°å¯è§ï¼‰

**å®¡æ ¸æ—¶é—´ï¼š** 1-2 ä¸ªå·¥ä½œæ—¥

---

## åˆ›å»ºåº”ç”¨

### æ­¥éª¤ 1ï¼šè¿›å…¥æ§åˆ¶å°

ç™»å½•åï¼Œç‚¹å‡»ã€Œæ§åˆ¶å°ã€â†’ã€Œç½‘é¡µ&ç§»åŠ¨åº”ç”¨ã€

### æ­¥éª¤ 2ï¼šåˆ›å»ºåº”ç”¨

ç‚¹å‡»ã€Œåˆ›å»ºåº”ç”¨ã€æŒ‰é’®

**åº”ç”¨ç±»å‹é€‰æ‹©ï¼š**
- âœ… é€‰æ‹©ã€Œç½‘é¡µåº”ç”¨ã€
- âŒ ä¸è¦é€‰æ‹©ã€Œç§»åŠ¨åº”ç”¨ã€ï¼ˆé‚£æ˜¯ç»™ APP ç”¨çš„ï¼‰

### æ­¥éª¤ 3ï¼šå¡«å†™åº”ç”¨åŸºæœ¬ä¿¡æ¯

**å¿…å¡«ä¿¡æ¯ï¼š**

```yaml
åº”ç”¨åç§°: VEO AI è§†é¢‘åˆ›ä½œå¹³å°
åº”ç”¨è‹±æ–‡åç§°: VEO AI Video Platform
åº”ç”¨ç®€ä»‹: AIé©±åŠ¨çš„æ™ºèƒ½è§†é¢‘ç”ŸæˆæœåŠ¡ï¼Œç”¨æˆ·é€šè¿‡è´­ä¹°ç§¯åˆ†ä½¿ç”¨è§†é¢‘ç”ŸæˆåŠŸèƒ½

åº”ç”¨å›¾æ ‡: [ä¸Šä¼ æ‚¨çš„åº”ç”¨å›¾æ ‡ icon.pngï¼Œå°ºå¯¸ 512x512px]

åº”ç”¨ç±»å‹: ç½‘é¡µåº”ç”¨
è¡Œä¸šåˆ†ç±»: 
  - ä¸€çº§åˆ†ç±»ï¼šå†…å®¹èµ„è®¯
  - äºŒçº§åˆ†ç±»ï¼šè§†é¢‘/ç›´æ’­

åº”ç”¨ç½‘å€: https://www.veo-ai.site
ICPå¤‡æ¡ˆå·: èœ€ICPå¤‡2025135924å· â­â­â­

æˆæƒå›è°ƒåœ°å€: 
  - https://www.veo-ai.site/api/payment/alipay/callback
  - https://veo-ai.site/api/payment/alipay/callback
```

**ä¸šåŠ¡è¯´æ˜ï¼š**

```
VEO AI æ˜¯ä¸€ä¸ªåŸºäºäººå·¥æ™ºèƒ½çš„è§†é¢‘ç”Ÿæˆå¹³å°ï¼Œä¸ºç”¨æˆ·æä¾›æ–‡æœ¬åˆ°è§†é¢‘çš„åˆ›ä½œæœåŠ¡ã€‚

ã€ä¸šåŠ¡æ¨¡å¼ã€‘
- ç”¨æˆ·é€šè¿‡è´­ä¹°ç§¯åˆ†å……å€¼å¥—é¤ä½¿ç”¨æœåŠ¡
- æ¯æ¬¡ç”Ÿæˆè§†é¢‘æ¶ˆè€— 15 ç§¯åˆ†
- ç§¯åˆ†å¥—é¤ä»·æ ¼ï¼šÂ¥49/50ç§¯åˆ†ï¼ŒÂ¥99/150ç§¯åˆ†ï¼ŒÂ¥299/500ç§¯åˆ†

ã€ä½¿ç”¨åœºæ™¯ã€‘
- å†…å®¹åˆ›ä½œè€…åˆ¶ä½œçŸ­è§†é¢‘
- ä¼ä¸šåˆ¶ä½œè¥é”€è§†é¢‘
- ä¸ªäººç”¨æˆ·åˆ¶ä½œåˆ›æ„è§†é¢‘

ã€åˆè§„è¯´æ˜ã€‘
- ç½‘ç«™å·²å®Œæˆ ICP å¤‡æ¡ˆï¼ˆèœ€ICPå¤‡2025135924å·ï¼‰
- å·²åˆ¶å®šå®Œå–„çš„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–
- å…·å¤‡å®Œæ•´çš„è”ç³»æ–¹å¼å’Œå®¢æœæ”¯æŒ
```

### æ­¥éª¤ 4ï¼šæäº¤åº”ç”¨ä¿¡æ¯

ç‚¹å‡»ã€Œæäº¤å®¡æ ¸ã€

**åˆå®¡æ—¶é—´ï¼š** 1 ä¸ªå·¥ä½œæ—¥

---

## é…ç½®å¯†é’¥

### ä¸ºä»€ä¹ˆéœ€è¦å¯†é’¥ï¼Ÿ

æ”¯ä»˜å®ä½¿ç”¨ **RSA2 éå¯¹ç§°åŠ å¯†** ä¿è¯äº¤æ˜“å®‰å…¨ã€‚æ‚¨éœ€è¦ï¼š
- **åº”ç”¨ç§é’¥**ï¼ˆè‡ªå·±ä¿ç®¡ï¼Œä¸èƒ½æ³„éœ²ï¼‰
- **åº”ç”¨å…¬é’¥**ï¼ˆä¸Šä¼ ç»™æ”¯ä»˜å®ï¼‰
- **æ”¯ä»˜å®å…¬é’¥**ï¼ˆä»æ”¯ä»˜å®è·å–ï¼‰

### æ­¥éª¤ 1ï¼šç”Ÿæˆå¯†é’¥å¯¹

**æ–¹å¼ Aï¼šä½¿ç”¨æ”¯ä»˜å®æä¾›çš„å·¥å…·ï¼ˆæ¨èï¼‰**

1. ä¸‹è½½å¯†é’¥ç”Ÿæˆå·¥å…·
   - è®¿é—®ï¼šhttps://opendocs.alipay.com/common/02khjo
   - ä¸‹è½½ã€Œæ”¯ä»˜å®å¯†é’¥ç”Ÿæˆå™¨ã€ï¼ˆæ”¯æŒ Windows/Macï¼‰

2. è¿è¡Œå·¥å…·
   - å¯†é’¥æ ¼å¼ï¼šé€‰æ‹©ã€ŒPKCS8(JAVAé€‚ç”¨)ã€
   - å¯†é’¥é•¿åº¦ï¼šé€‰æ‹©ã€Œ2048ã€
   - ç‚¹å‡»ã€Œç”Ÿæˆå¯†é’¥ã€

3. ä¿å­˜å¯†é’¥
   - åº”ç”¨ç§é’¥ï¼šä¿å­˜åˆ°å®‰å…¨ä½ç½®ï¼ˆåç»­é…ç½® `.env` ä½¿ç”¨ï¼‰
   - åº”ç”¨å…¬é’¥ï¼šå¤åˆ¶å†…å®¹ï¼Œå‡†å¤‡ä¸Šä¼ 

**æ–¹å¼ Bï¼šä½¿ç”¨ OpenSSLï¼ˆé«˜çº§ç”¨æˆ·ï¼‰**

```bash
# ç”Ÿæˆç§é’¥
openssl genrsa -out app_private_key.pem 2048

# ç”Ÿæˆå…¬é’¥
openssl rsa -in app_private_key.pem -pubout -out app_public_key.pem

# è½¬æ¢ä¸º PKCS8 æ ¼å¼
openssl pkcs8 -topk8 -inform PEM -in app_private_key.pem -outform PEM -nocrypt -out app_private_key_pkcs8.pem
```

### æ­¥éª¤ 2ï¼šä¸Šä¼ åº”ç”¨å…¬é’¥åˆ°æ”¯ä»˜å®

1. è¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ
2. æ‰¾åˆ°ã€Œå¼€å‘ä¿¡æ¯ã€â†’ã€Œæ¥å£åŠ ç­¾æ–¹å¼ã€
3. é€‰æ‹©ã€Œå…¬é’¥ã€æ¨¡å¼
4. ç‚¹å‡»ã€Œè®¾ç½®åº”ç”¨å…¬é’¥ã€
5. ç²˜è´´æ‚¨çš„åº”ç”¨å…¬é’¥å†…å®¹ï¼ˆæ³¨æ„ï¼šå»æ‰ `-----BEGIN PUBLIC KEY-----` å’Œ `-----END PUBLIC KEY-----` è¿™ä¸¤è¡Œï¼‰
6. ç‚¹å‡»ã€Œä¿å­˜ã€

### æ­¥éª¤ 3ï¼šè·å–æ”¯ä»˜å®å…¬é’¥

ä¸Šä¼ åº”ç”¨å…¬é’¥åï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºã€Œæ”¯ä»˜å®å…¬é’¥ã€

**å¤åˆ¶å¹¶ä¿å­˜ï¼š**
- æ”¯ä»˜å®å…¬é’¥ï¼ˆåç»­é…ç½® `.env` ä½¿ç”¨ï¼‰

**âš ï¸ é‡è¦æç¤ºï¼š**
- **åº”ç”¨ç§é’¥** ç»å¯¹ä¸èƒ½æ³„éœ²ï¼
- **åº”ç”¨ç§é’¥** ä¸è¦ä¸Šä¼ åˆ° GitHubï¼
- **åº”ç”¨ç§é’¥** å¿…é¡»ä¿å­˜åœ¨ `.env` æ–‡ä»¶ä¸­ï¼

---

## ç”³è¯·äº§å“åŠŸèƒ½

### æ”¯ä»˜å®æä¾›çš„äº§å“ç±»å‹

ä¸ªäººå¼€å‘è€…å¯ç”³è¯·çš„æ”¯ä»˜äº§å“ï¼ˆé€‰æ‹©å…¶ä¸€å³å¯ï¼‰ï¼š

#### 1. æ‰‹æœºç½‘ç«™æ”¯ä»˜ â­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- ç”¨æˆ·åœ¨æ‰‹æœºæµè§ˆå™¨è®¿é—®æ‚¨çš„ç½‘ç«™
- è·³è½¬åˆ°æ”¯ä»˜å® APP å®Œæˆæ”¯ä»˜
- æ”¯ä»˜å®Œæˆåè‡ªåŠ¨è¿”å›ç½‘ç«™

**ä¼˜åŠ¿ï¼š**
- âœ… ä¸ªäººå¼€å‘è€…å¯ç”³è¯·
- âœ… æ— éœ€è¥ä¸šæ‰§ç…§
- âœ… å®¡æ ¸ç›¸å¯¹å®¹æ˜“
- âœ… ç”¨æˆ·ä½“éªŒå¥½ï¼ˆæ‰‹æœºç«¯ä¸»æµï¼‰

**ç”³è¯·æ­¥éª¤ï¼š**

1. è¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ
2. ç‚¹å‡»ã€Œäº§å“åˆ—è¡¨ã€â†’ã€Œæ·»åŠ äº§å“ã€
3. æœç´¢ã€Œæ‰‹æœºç½‘ç«™æ”¯ä»˜ã€
4. ç‚¹å‡»ã€Œç«‹å³ç­¾çº¦ã€
5. å¡«å†™ç­¾çº¦ä¿¡æ¯ï¼š
   ```
   ç½‘ç«™åç§°: VEO AI è§†é¢‘åˆ›ä½œå¹³å°
   ç½‘ç«™åœ°å€: https://www.veo-ai.site
   ICPå¤‡æ¡ˆå·: èœ€ICPå¤‡2025135924å·
   
   ç½‘ç«™ç±»å‹: è§†é¢‘æœåŠ¡å¹³å°
   ä¸»è¥ä¸šåŠ¡: AIè§†é¢‘ç”ŸæˆæœåŠ¡
   ç»è¥æ¨¡å¼: ç§¯åˆ†å……å€¼
   
   å®¢æœç”µè¯: [æ‚¨çš„æ‰‹æœºå·]
   å®¢æœé‚®ç®±: 3533912007@qq.com
   ```
6. ä¸Šä¼ ç½‘ç«™æˆªå›¾ï¼š
   - é¦–é¡µæˆªå›¾
   - å……å€¼é¡µé¢æˆªå›¾
   - ç”¨æˆ·åè®®æˆªå›¾
   - éšç§æ”¿ç­–æˆªå›¾
7. æäº¤ç­¾çº¦

**å®¡æ ¸æ—¶é—´ï¼š** 1-2 ä¸ªå·¥ä½œæ—¥

#### 2. ç”µè„‘ç½‘ç«™æ”¯ä»˜ â­â­â­â­

**é€‚ç”¨åœºæ™¯ï¼š**
- ç”¨æˆ·åœ¨ç”µè„‘æµè§ˆå™¨è®¿é—®æ‚¨çš„ç½‘ç«™
- æ‰«ç å®Œæˆæ”¯ä»˜

**ç”³è¯·æ–¹å¼ï¼š** ä¸ã€Œæ‰‹æœºç½‘ç«™æ”¯ä»˜ã€ç±»ä¼¼

**å»ºè®®ï¼š** åŒæ—¶ç”³è¯·æ‰‹æœºå’Œç”µè„‘ç½‘ç«™æ”¯ä»˜ï¼Œè¦†ç›–æ‰€æœ‰åœºæ™¯

---

## é›†æˆå¼€å‘

### ç¯å¢ƒå˜é‡é…ç½®

å®¡æ ¸é€šè¿‡åï¼Œæ‚¨ä¼šè·å¾—ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

åœ¨ `veo-ai-platform/.env` ä¸­æ·»åŠ ï¼š

```bash
# ===== æ”¯ä»˜å®æ”¯ä»˜é…ç½® =====

# åº”ç”¨ IDï¼ˆåœ¨åº”ç”¨è¯¦æƒ…é¡µè·å–ï¼‰
ALIPAY_APP_ID=your_app_id_here

# æ”¯ä»˜å®ç½‘å…³ï¼ˆå›ºå®šå€¼ï¼‰
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do

# åº”ç”¨ç§é’¥ï¼ˆPKCS8 æ ¼å¼ï¼Œä¸€è¡Œå­—ç¬¦ä¸²ï¼Œå»æ‰æ¢è¡Œç¬¦å’Œ BEGIN/END æ ‡è®°ï¼‰
ALIPAY_PRIVATE_KEY=MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwgg...

# æ”¯ä»˜å®å…¬é’¥ï¼ˆä»æ”¯ä»˜å®å¼€æ”¾å¹³å°è·å–ï¼‰
ALIPAY_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMII...

# æ”¯ä»˜å›è°ƒåœ°å€ï¼ˆå¿…é¡»æ˜¯ HTTPSï¼Œä¸”ä¸ç”³è¯·æ—¶å¡«å†™çš„ä¸€è‡´ï¼‰
ALIPAY_NOTIFY_URL=https://www.veo-ai.site/api/payment/alipay/callback
ALIPAY_RETURN_URL=https://www.veo-ai.site/payment/success

# ç­¾åç±»å‹ï¼ˆå›ºå®šå€¼ï¼‰
ALIPAY_SIGN_TYPE=RSA2

# å­—ç¬¦ç¼–ç ï¼ˆå›ºå®šå€¼ï¼‰
ALIPAY_CHARSET=utf-8
```

### å®‰è£… SDK

```bash
cd veo-ai-platform
npm install alipay-sdk
```

### åˆ›å»ºæ”¯ä»˜æœåŠ¡

åˆ›å»º `src/lib/alipay.ts`ï¼š

```typescript
import AlipaySdk from 'alipay-sdk'
import AlipayFormData from 'alipay-sdk/lib/form'

// åˆå§‹åŒ–æ”¯ä»˜å® SDK
const alipaySdk = new AlipaySdk({
  appId: process.env.ALIPAY_APP_ID!,
  privateKey: process.env.ALIPAY_PRIVATE_KEY!,
  alipayPublicKey: process.env.ALIPAY_PUBLIC_KEY!,
  gateway: process.env.ALIPAY_GATEWAY!,
  signType: 'RSA2',
  charset: 'utf-8',
})

/**
 * åˆ›å»ºæ”¯ä»˜è®¢å•
 */
export async function createPayment(options: {
  outTradeNo: string      // å•†æˆ·è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰
  totalAmount: string     // è®¢å•é‡‘é¢ï¼ˆå…ƒï¼‰
  subject: string         // è®¢å•æ ‡é¢˜
  body?: string           // è®¢å•æè¿°
}) {
  const formData = new AlipayFormData()
  
  formData.setMethod('get')
  
  formData.addField('bizContent', {
    outTradeNo: options.outTradeNo,
    productCode: 'QUICK_WAP_WAY',
    totalAmount: options.totalAmount,
    subject: options.subject,
    body: options.body || options.subject,
    quitUrl: process.env.ALIPAY_RETURN_URL,
  })
  
  formData.addField('returnUrl', process.env.ALIPAY_RETURN_URL)
  formData.addField('notifyUrl', process.env.ALIPAY_NOTIFY_URL)
  
  // ç”Ÿæˆæ”¯ä»˜é“¾æ¥
  const result = await alipaySdk.exec(
    'alipay.trade.wap.pay',
    {},
    { formData }
  )
  
  return result
}

/**
 * éªŒè¯æ”¯ä»˜å®å›è°ƒç­¾å
 */
export function verifyNotify(params: Record<string, any>): boolean {
  return alipaySdk.checkNotifySign(params)
}

/**
 * æŸ¥è¯¢è®¢å•çŠ¶æ€
 */
export async function queryPayment(outTradeNo: string) {
  const result = await alipaySdk.exec('alipay.trade.query', {
    bizContent: {
      outTradeNo,
    },
  })
  
  return result
}
```

### åˆ›å»ºæ”¯ä»˜ API

åˆ›å»º `src/app/api/payment/create/route.ts`ï¼š

```typescript
import { NextRequest, NextResponse } from "next/server"
import { getServerSession } from "next-auth"
import { authOptions } from "@/lib/auth"
import { createPayment } from "@/lib/alipay"
import { pool } from "@/lib/db"
import { nanoid } from "nanoid"

export async function POST(req: NextRequest) {
  try {
    // éªŒè¯ç”¨æˆ·ç™»å½•
    const session = await getServerSession(authOptions)
    if (!session?.user?.id) {
      return NextResponse.json({ error: "æœªç™»å½•" }, { status: 401 })
    }
    
    const { packageId } = await req.json()
    
    // è·å–å¥—é¤ä¿¡æ¯
    const packageResult = await pool.query(
      "SELECT * FROM credit_packages WHERE id = $1 AND is_active = true",
      [packageId]
    )
    
    if (packageResult.rows.length === 0) {
      return NextResponse.json({ error: "å¥—é¤ä¸å­˜åœ¨" }, { status: 404 })
    }
    
    const creditPackage = packageResult.rows[0]
    
    // ç”Ÿæˆè®¢å•å·
    const outTradeNo = `VEO${Date.now()}${nanoid(8)}`
    
    // åˆ›å»ºè®¢å•è®°å½•
    await pool.query(
      `INSERT INTO payment_orders 
       (order_no, user_id, package_id, amount, status, created_at) 
       VALUES ($1, $2, $3, $4, $5, NOW())`,
      [outTradeNo, session.user.id, packageId, creditPackage.price, 'pending']
    )
    
    // åˆ›å»ºæ”¯ä»˜é“¾æ¥
    const paymentUrl = await createPayment({
      outTradeNo,
      totalAmount: creditPackage.price.toString(),
      subject: `VEO AI - ${creditPackage.name}`,
      body: `è´­ä¹°${creditPackage.credits}ç§¯åˆ†`,
    })
    
    return NextResponse.json({
      success: true,
      data: {
        orderNo: outTradeNo,
        paymentUrl,
      },
    })
    
  } catch (error) {
    console.error("åˆ›å»ºæ”¯ä»˜å¤±è´¥:", error)
    return NextResponse.json(
      { error: "åˆ›å»ºæ”¯ä»˜å¤±è´¥" },
      { status: 500 }
    )
  }
}
```

### åˆ›å»ºæ”¯ä»˜å›è°ƒ API

åˆ›å»º `src/app/api/payment/alipay/callback/route.ts`ï¼š

```typescript
import { NextRequest, NextResponse } from "next/server"
import { verifyNotify } from "@/lib/alipay"
import { pool } from "@/lib/db"

export async function POST(req: NextRequest) {
  try {
    const body = await req.json()
    
    // éªŒè¯ç­¾å
    if (!verifyNotify(body)) {
      console.error("æ”¯ä»˜å®å›è°ƒç­¾åéªŒè¯å¤±è´¥")
      return NextResponse.json({ error: "ç­¾åéªŒè¯å¤±è´¥" }, { status: 400 })
    }
    
    const {
      out_trade_no,  // å•†æˆ·è®¢å•å·
      trade_no,      // æ”¯ä»˜å®äº¤æ˜“å·
      trade_status,  // äº¤æ˜“çŠ¶æ€
      total_amount,  // è®¢å•é‡‘é¢
    } = body
    
    // åªå¤„ç†æ”¯ä»˜æˆåŠŸçš„å›è°ƒ
    if (trade_status === 'TRADE_SUCCESS' || trade_status === 'TRADE_FINISHED') {
      // æŸ¥è¯¢è®¢å•
      const orderResult = await pool.query(
        "SELECT * FROM payment_orders WHERE order_no = $1",
        [out_trade_no]
      )
      
      if (orderResult.rows.length === 0) {
        return NextResponse.json({ error: "è®¢å•ä¸å­˜åœ¨" }, { status: 404 })
      }
      
      const order = orderResult.rows[0]
      
      // æ£€æŸ¥è®¢å•æ˜¯å¦å·²å¤„ç†
      if (order.status === 'success') {
        return NextResponse.json({ success: true, message: "è®¢å•å·²å¤„ç†" })
      }
      
      // éªŒè¯é‡‘é¢
      if (parseFloat(total_amount) !== parseFloat(order.amount)) {
        console.error("è®¢å•é‡‘é¢ä¸åŒ¹é…")
        return NextResponse.json({ error: "é‡‘é¢ä¸åŒ¹é…" }, { status: 400 })
      }
      
      // å¼€å§‹äº‹åŠ¡
      const client = await pool.connect()
      try {
        await client.query('BEGIN')
        
        // æ›´æ–°è®¢å•çŠ¶æ€
        await client.query(
          `UPDATE payment_orders 
           SET status = $1, trade_no = $2, paid_at = NOW() 
           WHERE order_no = $3`,
          ['success', trade_no, out_trade_no]
        )
        
        // è·å–å¥—é¤ä¿¡æ¯
        const packageResult = await client.query(
          "SELECT * FROM credit_packages WHERE id = $1",
          [order.package_id]
        )
        const creditPackage = packageResult.rows[0]
        
        // å¢åŠ ç”¨æˆ·ç§¯åˆ†
        await client.query(
          `UPDATE user_credit_accounts 
           SET balance = balance + $1, 
               total_purchased = total_purchased + $1,
               updated_at = NOW()
           WHERE user_id = $2`,
          [creditPackage.credits, order.user_id]
        )
        
        // è®°å½•ç§¯åˆ†å˜åŠ¨
        await client.query(
          `INSERT INTO credit_transactions 
           (user_id, type, amount, balance_after, description, created_at)
           SELECT $1, 'purchase', $2, balance, $3, NOW()
           FROM user_credit_accounts WHERE user_id = $1`,
          [
            order.user_id,
            creditPackage.credits,
            `è´­ä¹°${creditPackage.name}`,
          ]
        )
        
        await client.query('COMMIT')
        
        return NextResponse.json({ success: true })
        
      } catch (error) {
        await client.query('ROLLBACK')
        throw error
      } finally {
        client.release()
      }
    }
    
    return NextResponse.json({ success: true })
    
  } catch (error) {
    console.error("å¤„ç†æ”¯ä»˜å›è°ƒå¤±è´¥:", error)
    return NextResponse.json(
      { error: "å¤„ç†å›è°ƒå¤±è´¥" },
      { status: 500 }
    )
  }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ªäººå¼€å‘è€…å®¡æ ¸æ˜¯å¦æ¯”ä¼ä¸šä¸¥æ ¼ï¼Ÿ

**ç­”ï¼š** æ˜¯çš„ï¼Œä¸ªäººå¼€å‘è€…å®¡æ ¸ä¼šæ›´ä¸¥æ ¼ã€‚å»ºè®®ï¼š
- ç¡®ä¿ç½‘ç«™å®Œæ•´ã€ä¸“ä¸š
- æä¾›è¯¦ç»†çš„ä¸šåŠ¡è¯´æ˜
- ç¡®ä¿å¤‡æ¡ˆä¿¡æ¯å‡†ç¡®æ— è¯¯
- å‡†å¤‡å¥½å®¢æœè”ç³»æ–¹å¼

### Q2: å®¡æ ¸è¢«æ‹’ç»æ€ä¹ˆåŠï¼Ÿ

**å¸¸è§æ‹’ç»åŸå› ï¼š**
1. å¤‡æ¡ˆå·æ— æ•ˆæˆ–ä¸åŸŸåä¸åŒ¹é…
   - **è§£å†³ï¼š** ç¡®ä¿å¤‡æ¡ˆå·²é€šè¿‡ä¸”åœ¨å·¥ä¿¡éƒ¨ç½‘ç«™å¯æŸ¥è¯¢
2. ç½‘ç«™å†…å®¹ä¸å®Œæ•´
   - **è§£å†³ï¼š** è¡¥å……ç”¨æˆ·åè®®ã€éšç§æ”¿ç­–ã€è”ç³»æ–¹å¼
3. ä¸šåŠ¡è¯´æ˜ä¸æ¸…æ™°
   - **è§£å†³ï¼š** è¯¦ç»†è¯´æ˜ä¸šåŠ¡æ¨¡å¼ã€ä½¿ç”¨åœºæ™¯
4. ç½‘ç«™æ— æ³•è®¿é—®
   - **è§£å†³ï¼š** ç¡®ä¿ç½‘ç«™å·²éƒ¨ç½²ä¸”ä½¿ç”¨ HTTPS

**å¤„ç†æµç¨‹ï¼š**
- æ ¹æ®æ‹’ç»åŸå› ä¿®æ”¹
- é‡æ–°æäº¤å®¡æ ¸
- é€šå¸¸ 2-3 æ¬¡æäº¤åä¼šé€šè¿‡

### Q3: ä¸ªäººè´¦å·æœ‰äº¤æ˜“é™é¢å—ï¼Ÿ

**ç­”ï¼š** æœ‰é™åˆ¶ï¼Œå…·ä½“ä¸ºï¼š
- å•ç¬”é™é¢ï¼šé€šå¸¸ Â¥500-Â¥1000
- æ—¥é™é¢ï¼šÂ¥2000-Â¥5000
- æœˆé™é¢ï¼šÂ¥20000-Â¥50000

**å»ºè®®ï¼š**
- åˆæœŸä½¿ç”¨ä¸ªäººè´¦å·æµ‹è¯•
- ä¸šåŠ¡å¢é•¿åå‡çº§ä¸ºä¼ä¸šè´¦å·

### Q4: å¦‚ä½•æµ‹è¯•æ”¯ä»˜åŠŸèƒ½ï¼Ÿ

**æ²™ç®±ç¯å¢ƒï¼š**
1. è®¿é—®ï¼šhttps://open.alipay.com/dev/workspace
2. ä½¿ç”¨æ²™ç®±åº”ç”¨ ID å’Œå¯†é’¥
3. ä½¿ç”¨æ²™ç®±è´¦å·æµ‹è¯•æ”¯ä»˜
4. æµ‹è¯•é€šè¿‡ååˆ‡æ¢åˆ°æ­£å¼ç¯å¢ƒ

**âš ï¸ æ³¨æ„ï¼š**
- æ²™ç®±ç¯å¢ƒä¸éœ€è¦çœŸå®å¤‡æ¡ˆ
- æ²™ç®±ç¯å¢ƒä¸ä¼šäº§ç”ŸçœŸå®æ‰£æ¬¾
- æµ‹è¯•å®Œæˆåå¿…é¡»åˆ‡æ¢åˆ°æ­£å¼ç¯å¢ƒ

### Q5: å›è°ƒåœ°å€å¿…é¡»æ˜¯ HTTPS å—ï¼Ÿ

**ç­”ï¼š** æ˜¯çš„ï¼æ”¯ä»˜å®è¦æ±‚ï¼š
- âœ… å¿…é¡»ä½¿ç”¨ HTTPS
- âœ… å¿…é¡»æ˜¯å·²å¤‡æ¡ˆçš„åŸŸå
- âœ… å¿…é¡»å¯å…¬ç½‘è®¿é—®
- âŒ ä¸èƒ½ä½¿ç”¨ localhost æˆ– IP åœ°å€

### Q6: å¦‚ä½•å¤„ç†é‡å¤å›è°ƒï¼Ÿ

æ”¯ä»˜å®å¯èƒ½ä¼šå¤šæ¬¡å‘é€å›è°ƒé€šçŸ¥ï¼Œæ‚¨çš„ä»£ç å¿…é¡»ï¼š
1. æ£€æŸ¥è®¢å•æ˜¯å¦å·²å¤„ç†ï¼ˆ`status === 'success'`ï¼‰
2. å¦‚æœå·²å¤„ç†ï¼Œç›´æ¥è¿”å›æˆåŠŸ
3. ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿åŸå­æ€§

### Q7: ç”¨æˆ·æ”¯ä»˜åå¤šä¹…åˆ°è´¦ï¼Ÿ

- æ”¯ä»˜æˆåŠŸåï¼š**å®æ—¶åˆ°è´¦**åˆ°æ‚¨çš„æ”¯ä»˜å®è´¦æˆ·
- å›è°ƒé€šçŸ¥ï¼šé€šå¸¸ **1-5 ç§’**å†…æ”¶åˆ°
- ç”¨æˆ·ç§¯åˆ†ï¼šå›è°ƒå¤„ç†æˆåŠŸå**ç«‹å³ç”Ÿæ•ˆ**

---

## å®¡æ ¸æ£€æŸ¥æ¸…å•

åœ¨æäº¤å®¡æ ¸å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ç›®ï¼š

### ç½‘ç«™æ£€æŸ¥
- [ ] ç½‘ç«™å¯é€šè¿‡ `https://www.veo-ai.site` è®¿é—®
- [ ] é¦–é¡µæ˜¾ç¤ºå®Œæ•´çš„äº§å“ä¿¡æ¯
- [ ] åº•éƒ¨æ˜¾ç¤ºå¤‡æ¡ˆå·ï¼ˆèœ€ICPå¤‡2025135924å·ï¼‰
- [ ] ç”¨æˆ·åè®®é¡µé¢å®Œæ•´ï¼š`/terms`
- [ ] éšç§æ”¿ç­–é¡µé¢å®Œæ•´ï¼š`/privacy`
- [ ] è”ç³»æ–¹å¼é¡µé¢å®Œæ•´ï¼š`/contact`
- [ ] å……å€¼é¡µé¢å±•ç¤ºæ¸…æ™°çš„å¥—é¤ä¿¡æ¯

### æ”¯ä»˜å®å¼€æ”¾å¹³å°
- [ ] å¼€å‘è€…ä¿¡æ¯å·²å®åè®¤è¯
- [ ] åº”ç”¨å·²åˆ›å»ºå¹¶å¡«å†™å®Œæ•´ä¿¡æ¯
- [ ] ICP å¤‡æ¡ˆå·å·²æ­£ç¡®å¡«å†™
- [ ] åº”ç”¨å…¬é’¥å·²ä¸Šä¼ 
- [ ] æ”¯ä»˜å®å…¬é’¥å·²ä¿å­˜
- [ ] å›è°ƒåœ°å€å·²é…ç½®
- [ ] äº§å“åŠŸèƒ½å·²ç­¾çº¦

### ä»£ç å‡†å¤‡
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ`.env`ï¼‰
- [ ] æ”¯ä»˜æœåŠ¡å·²å®ç°ï¼ˆ`src/lib/alipay.ts`ï¼‰
- [ ] æ”¯ä»˜ API å·²å®ç°
- [ ] å›è°ƒ API å·²å®ç°
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆ`payment_orders`ï¼‰

---

## æŠ€æœ¯æ”¯æŒ

### å®˜æ–¹æ–‡æ¡£
- å¼€æ”¾å¹³å°é¦–é¡µï¼šhttps://open.alipay.com
- å¼€å‘æ–‡æ¡£ï¼šhttps://opendocs.alipay.com
- æ²™ç®±ç¯å¢ƒï¼šhttps://open.alipay.com/dev/workspace

### é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å¸¸è§é—®é¢˜
2. è®¿é—®å¼€å‘è€…ç¤¾åŒºï¼šhttps://forum.alipay.com
3. è”ç³»æ”¯ä»˜å®å®¢æœï¼ˆå¼€æ”¾å¹³å°åå°ï¼‰

---

## æ€»ç»“

**ä¸ªäººå¼€å‘è€…ç”³è¯·æ”¯ä»˜å®æ”¯ä»˜çš„å…³é”®ç‚¹ï¼š**

1. âœ… **å¿…é¡»æœ‰ ICP å¤‡æ¡ˆ**ï¼ˆæ‚¨å·²å®Œæˆï¼šèœ€ICPå¤‡2025135924å·ï¼‰
2. âœ… **ç½‘ç«™å¿…é¡»å®Œæ•´ã€ä¸“ä¸š**ï¼ˆç”¨æˆ·åè®®ã€éšç§æ”¿ç­–ç­‰ï¼‰
3. âœ… **ä¸šåŠ¡è¯´æ˜æ¸…æ™°**ï¼ˆAI è§†é¢‘ç”Ÿæˆã€ç§¯åˆ†å……å€¼æ¨¡å¼ï¼‰
4. âœ… **å›è°ƒåœ°å€ä½¿ç”¨ HTTPS**
5. â° **è€å¿ƒç­‰å¾…å®¡æ ¸**ï¼ˆä¸ªäººå¼€å‘è€…å®¡æ ¸è¾ƒä¸¥æ ¼ï¼Œå¯èƒ½éœ€è¦ 2-3 æ¬¡æäº¤ï¼‰

**é¢„è®¡æ—¶é—´çº¿ï¼š**
- ææ–™å‡†å¤‡ï¼š1-2 å°æ—¶
- æäº¤å®¡æ ¸ï¼š2-4 ä¸ªå·¥ä½œæ—¥
- é›†æˆå¼€å‘ï¼š1-2 å¤©
- **æ€»è®¡ï¼šçº¦ 1 å‘¨**

ç¥æ‚¨ç”³è¯·é¡ºåˆ©ï¼ğŸ‰

