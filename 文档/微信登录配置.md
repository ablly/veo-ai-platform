# ğŸ’¬ VEO AI å¾®ä¿¡ç™»å½•é…ç½®æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

- âœ… å¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·
- âœ… å·²è®¤è¯çš„å¼€å‘è€…èµ„è´¨
- âœ… å·²å¤‡æ¡ˆçš„åŸŸå

---

## ğŸš€ é…ç½®æ­¥éª¤

### ç¬¬1æ­¥ï¼šæ³¨å†Œå¾®ä¿¡å¼€æ”¾å¹³å°

1. è®¿é—® https://open.weixin.qq.com/
2. ç‚¹å‡»"æ³¨å†Œ"
3. å¡«å†™ä¼ä¸š/ä¸ªäººä¿¡æ¯
4. å®Œæˆè®¤è¯ï¼ˆéœ€è¦è¥ä¸šæ‰§ç…§ï¼‰

**è´¹ç”¨**ï¼š
- ä¸ªäººå¼€å‘è€…ï¼šå…è´¹
- ä¼ä¸šå¼€å‘è€…ï¼š300å…ƒ/å¹´è®¤è¯è´¹

---

### ç¬¬2æ­¥ï¼šåˆ›å»ºç½‘ç«™åº”ç”¨

1. ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°
2. ç®¡ç†ä¸­å¿ƒ â†’ ç½‘ç«™åº”ç”¨ â†’ åˆ›å»ºç½‘ç«™åº”ç”¨

**å¡«å†™ä¿¡æ¯**ï¼š
- åº”ç”¨åç§°ï¼šVEO AI è§†é¢‘ç”Ÿæˆå¹³å°
- åº”ç”¨ç®€ä»‹ï¼šåŸºäºAIçš„è§†é¢‘åˆ›ä½œå¹³å°
- åº”ç”¨å®˜ç½‘ï¼šhttps://ä½ çš„åŸŸå.com
- åº”ç”¨å›¾æ ‡ï¼šä¸Šä¼ Logoï¼ˆ108x108ï¼‰

**æˆæƒå›è°ƒåŸŸ**ï¼š
```
https://ä½ çš„åŸŸå.com/api/auth/callback/wechat
```

**æ³¨æ„**ï¼š
- å¿…é¡»ä½¿ç”¨HTTPS
- åŸŸåå¿…é¡»å·²å¤‡æ¡ˆ
- å¿…é¡»å¯ä»¥æ­£å¸¸è®¿é—®

---

### ç¬¬3æ­¥ï¼šè·å–AppIDå’ŒAppSecret

åº”ç”¨åˆ›å»ºæˆåŠŸåï¼š

1. æŸ¥çœ‹åº”ç”¨è¯¦æƒ…
2. å¤åˆ¶ AppID
3. å¤åˆ¶ AppSecretï¼ˆç‚¹å‡»æŸ¥çœ‹ï¼‰

**ç¤ºä¾‹**ï¼š
```
AppID: wx1234567890abcdef
AppSecret: 1234567890abcdef1234567890abcdef
```

---

### ç¬¬4æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘é¡¹ç›®çš„ `.env` æ–‡ä»¶ï¼š

```env
# å¾®ä¿¡ç™»å½•é…ç½®
WECHAT_APP_ID="wx1234567890abcdef"
WECHAT_APP_SECRET="1234567890abcdef1234567890abcdef"
```

---

### ç¬¬5æ­¥ï¼šæµ‹è¯•å¾®ä¿¡ç™»å½•

1. é‡å¯åº”ç”¨
```bash
pm2 restart veo-ai
```

2. è®¿é—®ç™»å½•é¡µé¢
3. ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’®
4. æ‰«ç ç™»å½•

**é¦–æ¬¡ç™»å½•**ï¼š
- è‡ªåŠ¨åˆ›å»ºè´¦å·
- ç»‘å®šå¾®ä¿¡OpenID
- èµ é€10ç§¯åˆ†

**å†æ¬¡ç™»å½•**ï¼š
- è‡ªåŠ¨è¯†åˆ«è´¦å·
- æ›´æ–°å¾®ä¿¡ä¿¡æ¯
- ç›´æ¥ç™»å½•æˆåŠŸ

---

## ğŸ” éªŒè¯é…ç½®

### æ£€æŸ¥ç¯å¢ƒå˜é‡
```bash
# æŸ¥çœ‹é…ç½®
cat .env | grep WECHAT

# åº”è¯¥è¾“å‡º
WECHAT_APP_ID="wx..."
WECHAT_APP_SECRET="..."
```

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
pm2 logs veo-ai
```

**æˆåŠŸæ—¥å¿—**ï¼š
```
âœ… æ–°ç”¨æˆ·é€šè¿‡å¾®ä¿¡æ³¨å†Œ: å¼ ä¸‰, èµ é€ç§¯åˆ†: 10
âœ… ç”¨æˆ·é€šè¿‡å¾®ä¿¡ç™»å½•: å¼ ä¸‰
```

**é”™è¯¯æ—¥å¿—**ï¼š
```
âŒ å¾®ä¿¡ç™»å½•å¤„ç†å¤±è´¥: invalid appid
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æ‰«ç åæç¤º"redirect_uriå‚æ•°é”™è¯¯"

**åŸå› **ï¼š
- æˆæƒå›è°ƒåŸŸé…ç½®é”™è¯¯
- åŸŸåæœªå¤‡æ¡ˆ
- ä½¿ç”¨äº†HTTPè€ŒéHTTPS

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥å¾®ä¿¡å¼€æ”¾å¹³å°çš„æˆæƒå›è°ƒåŸŸ
2. ç¡®ä¿ä½¿ç”¨ `https://ä½ çš„åŸŸå.com/api/auth/callback/wechat`
3. ç¡®ä¿åŸŸåå·²å¤‡æ¡ˆä¸”å¯è®¿é—®

---

### 2. æç¤º"appidä¸å­˜åœ¨"

**åŸå› **ï¼š
- AppIDå¡«å†™é”™è¯¯
- åº”ç”¨æœªæäº¤å®¡æ ¸
- åº”ç”¨è¢«ç¦ç”¨

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `.env` ä¸­çš„ `WECHAT_APP_ID`
2. ç¡®ä¿åº”ç”¨å·²æäº¤å¹¶é€šè¿‡å®¡æ ¸
3. æ£€æŸ¥åº”ç”¨çŠ¶æ€

---

### 3. æ‰«ç åæ— ååº”

**åŸå› **ï¼š
- AppSecreté”™è¯¯
- å›è°ƒåŸŸåé”™è¯¯
- æœåŠ¡å™¨æ— æ³•è®¿é—®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `.env` ä¸­çš„ `WECHAT_APP_SECRET`
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
3. ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—®å¾®ä¿¡API

---

### 4. ç™»å½•æˆåŠŸä½†æ²¡æœ‰è·å¾—ç§¯åˆ†

**åŸå› **ï¼š
- æ•°æ®åº“è¿æ¥å¤±è´¥
- ç§¯åˆ†èµ é€é€»è¾‘é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
3. æ‰‹åŠ¨ç»™ç”¨æˆ·åŠ ç§¯åˆ†ï¼ˆä¸´æ—¶ï¼‰

```sql
-- æ‰‹åŠ¨èµ é€ç§¯åˆ†
UPDATE user_credit_accounts 
SET available_credits = available_credits + 10 
WHERE user_id = 'ç”¨æˆ·ID';
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä¿æŠ¤AppSecret

**ä¸è¦**ï¼š
- âŒ æäº¤åˆ°Gitä»“åº“
- âŒ åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²
- âŒ é€šè¿‡HTTPä¼ è¾“

**åº”è¯¥**ï¼š
- âœ… å­˜å‚¨åœ¨ `.env` æ–‡ä»¶
- âœ… ä»…åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨
- âœ… å®šæœŸæ›´æ¢

### 2. éªŒè¯ç”¨æˆ·ä¿¡æ¯

**å·²å®ç°**ï¼š
- âœ… éªŒè¯OpenIDå”¯ä¸€æ€§
- âœ… éªŒè¯UnionIDï¼ˆå¦‚æœæœ‰ï¼‰
- âœ… é˜²æ­¢é‡å¤æ³¨å†Œ

### 3. é™åˆ¶å›è°ƒåŸŸå

**è®¾ç½®**ï¼š
- âœ… åªè®¾ç½®ç”Ÿäº§ç¯å¢ƒåŸŸå
- âœ… ä¸è®¾ç½®é€šé…ç¬¦åŸŸå
- âœ… ä½¿ç”¨HTTPS

---

## ğŸ“Š å¾®ä¿¡ç™»å½•æµç¨‹

### ç”¨æˆ·è§†è§’
```
1. ç”¨æˆ·ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
   â†“
2. æ˜¾ç¤ºå¾®ä¿¡äºŒç»´ç 
   â†“
3. ç”¨æˆ·æ‰«ç ç¡®è®¤
   â†“
4. è‡ªåŠ¨ç™»å½•æˆåŠŸ
```

### æŠ€æœ¯å®ç°
```
1. å‰ç«¯è°ƒç”¨ signIn("wechat")
   â†“
2. è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢
   â†“
3. ç”¨æˆ·æ‰«ç æˆæƒ
   â†“
4. å¾®ä¿¡å›è°ƒåˆ° /api/auth/callback/wechat
   â†“
5. è·å–codeæ¢å–access_token
   â†“
6. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆopenid, nickname, avatarï¼‰
   â†“
7. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
   â†“
8. èµ é€æ–°ç”¨æˆ·ç§¯åˆ†
   â†“
9. åˆ›å»ºSessionå¹¶è·³è½¬
```

---

## ğŸ“ æ•°æ®åº“å­˜å‚¨

### usersè¡¨å­—æ®µ

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  wechat_openid VARCHAR(128) UNIQUE,    -- å¾®ä¿¡OpenID
  wechat_unionid VARCHAR(128),          -- å¾®ä¿¡UnionID
  wechat_nickname VARCHAR(128),         -- å¾®ä¿¡æ˜µç§°
  name VARCHAR(128),                    -- æ˜¾ç¤ºåç§°
  avatar TEXT,                          -- å¤´åƒURL
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

### å­—æ®µè¯´æ˜

- **wechat_openid**: ç”¨æˆ·åœ¨å½“å‰åº”ç”¨çš„å”¯ä¸€æ ‡è¯†
- **wechat_unionid**: ç”¨æˆ·åœ¨åŒä¸€å¼€æ”¾å¹³å°ä¸‹çš„å”¯ä¸€æ ‡è¯†
- **wechat_nickname**: å¾®ä¿¡æ˜µç§°ï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰
- **avatar**: å¾®ä¿¡å¤´åƒï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¤šè´¦å·ç»‘å®š

**åŠŸèƒ½**ï¼š
- å…è®¸å¾®ä¿¡è´¦å·ç»‘å®šé‚®ç®±
- å…è®¸é‚®ç®±è´¦å·ç»‘å®šå¾®ä¿¡
- æ”¯æŒå¤šç§ç™»å½•æ–¹å¼

**å®ç°**ï¼ˆå¾…å¼€å‘ï¼‰ï¼š
```typescript
// ç»‘å®šå¾®ä¿¡åˆ°ç°æœ‰è´¦å·
const bindWechat = async (userId, openid, unionid) => {
  await updateUser(userId, { 
    wechat_openid: openid,
    wechat_unionid: unionid 
  })
}
```

### 2. ä¿¡æ¯åŒæ­¥

**è‡ªåŠ¨åŒæ­¥**ï¼š
- æ¯æ¬¡ç™»å½•æ›´æ–°å¾®ä¿¡æ˜µç§°
- æ¯æ¬¡ç™»å½•æ›´æ–°å¾®ä¿¡å¤´åƒ

**ä»£ç **ï¼š
```typescript
// src/lib/auth.ts signIn callback
await client.query(
  `UPDATE users 
   SET wechat_nickname = $1, avatar = $2, updated_at = NOW() 
   WHERE id = $3`,
  [user.name, user.image, existingUser.id]
)
```

### 3. UnionIDä½¿ç”¨

**ä»€ä¹ˆæ˜¯UnionID**ï¼š
- åŒä¸€å¼€æ”¾å¹³å°ä¸‹çš„å”¯ä¸€æ ‡è¯†
- è·¨åº”ç”¨è¯†åˆ«åŒä¸€ç”¨æˆ·

**ä½¿ç”¨åœºæ™¯**ï¼š
- å¤šä¸ªç½‘ç«™/APPå…±äº«ç”¨æˆ·ç³»ç»Ÿ
- ç»Ÿä¸€ç”¨æˆ·ç®¡ç†

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

**å¾®ä¿¡å¼€æ”¾å¹³å°æ–‡æ¡£**ï¼š
https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html

**å¸¸è§é—®é¢˜**ï¼š
æŸ¥çœ‹ã€Šæ•…éšœæ’é™¤.mdã€‹

**æŠ€æœ¯æ”¯æŒ**ï¼š
æŸ¥çœ‹åº”ç”¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**é…ç½®å®Œæˆåï¼Œæ‚¨çš„ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨å¾®ä¿¡å¿«é€Ÿç™»å½•äº†ï¼** ğŸ‰


