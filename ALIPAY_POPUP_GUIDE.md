# 支付宝配置弹窗处理指南 🚀

> 针对支付宝开放平台弹窗的详细操作说明

---

## 📋 弹窗1：接口内容加密方式（AES加密）

### 弹窗内容
```
接口内容加密方式
AES: 23s+vRe5HNDNxMd5LXUZw==

[取消]  [更新生成密钥]
```

### ❌ 建议操作：点击"取消"

### 为什么不需要AES加密？

1. **RSA2签名已足够**
   - 您已经配置了RSA2加密（应用公钥/私钥）
   - RSA2提供了足够的安全保障

2. **AES主要用于敏感信息加密**
   - 用户手机号、身份证号等敏感信息
   - 对于积分购买场景不需要

3. **简化开发复杂度**
   - 不配置AES可以避免额外的加解密代码
   - 减少潜在的技术问题

4. **VEO AI项目不需要**
   - 代码中未实现AES解密逻辑
   - 增加AES会导致支付失败

### ✅ 正确操作
```
1. 看到"接口内容加密方式"弹窗
2. 点击"取消"按钮
3. 不保存AES密钥
```

---

## 📋 弹窗2：应用网关（回调地址）⚠️ 重要！

### 弹窗内容
```
应用网关

HTTP协议网关地址，通常以http://或http://开头，强烈建议使用安全的TLS协议
(https)，以便于数据传输安全，保障数据安全。

[文本输入框]

* 加签方式：  ○ RSA2

[确定]  [取消]
```

### ✅ 必须配置！

### 什么是应用网关？

**应用网关 = 支付回调地址**

- 用户支付成功后，支付宝会向这个地址发送异步通知
- 您的服务器接收通知后，更新订单状态，发放积分
- **如果不配置，将无法接收支付通知，积分无法到账！**

### ✅ 正确配置步骤

#### 步骤1：填写回调地址

在文本框中输入：
```
https://www.veo-ai.site/api/payment/alipay/notify
```

**注意事项：**
- ✅ 必须以 `https://` 开头（不能用http）
- ✅ 域名：`www.veo-ai.site`
- ✅ 路径：`/api/payment/alipay/notify`
- ✅ 不要有多余的空格或换行

#### 步骤2：确认加签方式

- ✅ 选择：**RSA2**（应该已经默认选中）
- ❌ 不要选择RSA（旧版本，不安全）

#### 步骤3：点击确定

- 点击"确定"按钮
- 系统会保存配置

---

## 🔄 完整配置流程

### 当前您在做什么？

您正在完成"开发设置"中的配置，包括：

1. ✅ **接口加签方式（应用公钥）** - 已完成
2. ⚠️ **接口内容加密方式（AES）** - 点击"取消"
3. ⚠️ **应用网关（回调地址）** - 必须配置

### 正确的操作顺序

```
┌─────────────────────────────────────┐
│ 1. 接口加签方式                        │
│    ✅ 已完成：上传应用公钥              │
│    ✅ 已获取：支付宝公钥                │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ 2. 接口内容加密方式（可选）             │
│    ❌ 操作：点击"取消"                 │
│    ℹ️  说明：不需要AES加密              │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ 3. 应用网关（必须配置）                │
│    ✅ 填写：https://www.veo-ai.site/  │
│            api/payment/alipay/notify │
│    ✅ 加签：RSA2                      │
│    ✅ 点击："确定"                    │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│ 4. 保存配置                          │
│    点击页面底部"保存"按钮              │
└─────────────────────────────────────┘
```

---

## 📸 配置参考

### 应用网关配置示例

**文本框内容（完整复制粘贴）：**
```
https://www.veo-ai.site/api/payment/alipay/notify
```

**加签方式：**
```
● RSA2  （选中）
○ RSA   （不选）
```

**配置说明：**
- 这个地址指向VEO AI平台的支付回调接口
- 代码位置：`src/app/api/payment/alipay/notify/route.ts`
- 功能：接收支付宝的支付成功通知，更新订单状态，发放积分

---

## ❓ 常见问题

### Q1: 为什么不需要AES加密？

**A:** 
- 您的应用场景是积分购买，不涉及用户敏感信息传输
- RSA2签名已经提供了足够的安全性
- 代码中未实现AES解密，配置会导致错误

### Q2: 应用网关地址写错了怎么办？

**A:** 
- 可以随时修改
- 进入：开发设置 → 应用网关 → 编辑
- 修改后点击保存即可

### Q3: 必须用HTTPS吗？

**A:** 
- ✅ 是的，支付宝强制要求HTTPS
- ❌ HTTP地址无法通过验证
- 您的网站已经配置了HTTPS，没问题

### Q4: 如何测试应用网关是否配置成功？

**A:** 
- 配置完成后，申请产品能力并审核通过
- 测试支付，查看EdgeOne日志
- 如果收到支付宝的POST请求，说明配置成功

### Q5: 如果误点了"更新生成密钥"怎么办？

**A:** 
- 不用担心，可以在"接口内容加密方式"中删除或禁用
- 或者在代码中增加AES解密逻辑（不推荐）

---

## ✅ 配置完成检查清单

配置完成后，请确认：

- [ ] **接口加签方式**
  - [x] 已上传应用公钥
  - [x] 已获取支付宝公钥
  - [x] 加签方式：RSA2

- [ ] **接口内容加密方式**
  - [x] 已点击"取消"（不配置AES）

- [ ] **应用网关**
  - [ ] 已填写：`https://www.veo-ai.site/api/payment/alipay/notify`
  - [ ] 加签方式：RSA2
  - [ ] 已点击"确定"

- [ ] **保存配置**
  - [ ] 点击页面"保存"按钮

---

## 🎯 下一步

配置完成后，您应该：

1. **获取支付宝公钥**（如果还没获取）
   - 在"接口加签方式"页面查看并复制

2. **申请产品能力**
   - 进入：功能列表 → 电脑网站支付 → 申请
   - 填写业务描述（参考MY_ALIPAY_CONFIG.md）
   - 上传截图和营业执照

3. **等待审核**
   - 1-3个工作日

4. **配置EdgeOne环境变量**
   - 审核通过后配置

---

## 📞 需要帮助？

如果遇到问题：

1. 查看 `MY_ALIPAY_CONFIG.md` - 您的配置记录
2. 查看 `ALIPAY_QUICK_CHECKLIST.md` - 快速清单
3. 查看 `ALIPAY_ENTERPRISE_SETUP_GUIDE.md` - 详细教程
4. 支付宝客服：95188（商家服务）

---

**文档版本：** v1.0  
**创建时间：** 2025-10-29  
**适用场景：** 支付宝开放平台弹窗配置

